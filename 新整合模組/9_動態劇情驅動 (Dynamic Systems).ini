(* ============================================================ *)
(* ==     åˆä½µæ¨¡çµ„ Part 9: å‹•æ…‹åŠ‡æƒ…é©…å‹• (Dynamic Systems)     == *)
(* ============================================================ *)

(* === Note: ğŸ“œ ä»»å‹™èˆ‡äº‹ä»¶æ¨¡çµ„ (quest_event_system.ml) æœªæ‰¾åˆ°ç¨ç«‹å®šç¾©æ–‡ä»¶ === *)
(* ===       å°‡ä½¿ç”¨å‚™ä»½æŒ‡ä»¤ä¸­å®šç¾©çš„ quest_snapshot_t çµæ§‹ç®¡ç†ä»»å‹™        === *)


(* === Content from: ğŸ² å‹•æ…‹éš¨æ©Ÿäº‹ä»¶ç³»çµ±æ¨¡çµ„ (dynamic_random_event_system.ml).ini === *)
[source: 170] # ğŸ² å‹•æ…‹éš¨æ©Ÿäº‹ä»¶ç³»çµ±æ¨¡çµ„ (dynamic_random_event_system.ml)

## ğŸ“˜ æ¨¡çµ„èªªæ˜
æ­¤æ¨¡çµ„è² è²¬åœ¨éŠæˆ²é‹è¡Œéç¨‹ä¸­ï¼Œæ ¹æ“šç‰¹å®šæ¢ä»¶æˆ–æ™‚é–“è§¸ç™¼éš¨æ©Ÿäº‹ä»¶ï¼Œå¢åŠ éŠæˆ²çš„ä¸å¯é æ¸¬æ€§å’Œé‡ç©åƒ¹å€¼ã€‚äº‹ä»¶å¯ä»¥æ˜¯å°å‹çš„ç’°å¢ƒäº’å‹•ã€NPC çš„ç‰¹æ®Šè¡Œç‚ºã€çªç™¼çš„å±æ©Ÿæˆ–æ©Ÿé‡ç­‰ã€‚

---

## âš™ï¸ æ ¸å¿ƒæ©Ÿåˆ¶ï¼šäº‹ä»¶è§¸ç™¼èˆ‡åŸ·è¡Œ
```ml
(* äº‹ä»¶è§¸ç™¼æª¢æŸ¥æ™‚æ©Ÿ *)
let event_check_timing = [
  "æ¯å€‹éŠæˆ²å…§æ™‚é–“å–®ä½çµæŸæ™‚ (å¦‚æ¯å°æ™‚/æ¯å¤©)";
  "ç©å®¶é€²å…¥ç‰¹å®šåœ°é»/å€åŸŸæ™‚";
  "ç©å®¶åŸ·è¡Œç‰¹å®šé¡å‹å‹•ä½œæ™‚ (å¦‚æ¢ç´¢/ä¼‘æ¯/äº¤æ˜“)";
  "ç‰¹å®šéŠæˆ²ç‹€æ…‹é”æˆæ™‚ (å¦‚è³‡æºæ¥µä½/å£«æ°£é«˜æ¼²/é—œä¿‚æƒ¡åŒ–)";
  "AI ä¸»å‹•æ³¨å…¥ (ä½œç‚ºåŠ‡æƒ…æ¨é€²æˆ–èª¿åŠ‘)";
];;

(* äº‹ä»¶è§¸ç™¼åˆ¤å®šé‚è¼¯ *)
let event_trigger_logic = {
  base_probability = 0.05; (* åŸºç¤è§¸ç™¼æ¦‚ç‡ (e.g., æ¯å¤©æœ‰ 5% åŸºç¤æ¦‚ç‡è§¸ç™¼ä¸€å€‹éš¨æ©Ÿäº‹ä»¶) *)
  modifier_calculation = """
  è§¸ç™¼æ¦‚ç‡ = åŸºç¤æ¦‚ç‡ * (1 + æ¢ä»¶ä¿®æ­£å› å­ç¸½å’Œ)
  - æ¢ä»¶ä¿®æ­£å› å­ä¾†æº:
    - æ™‚é–“/å­£ç¯€ (æŸäº›äº‹ä»¶åªåœ¨ç‰¹å®šæ™‚é–“ç™¼ç”Ÿ)
    - åœ°é»/å€åŸŸ (æŸäº›äº‹ä»¶åªåœ¨ç‰¹å®šåœ°é»ç™¼ç”Ÿ)
    - ç©å®¶ç‹€æ…‹ (é«˜ç–²å‹/ä½SANå¯èƒ½è§¸ç™¼è² é¢äº‹ä»¶)
    - NPC ç‹€æ…‹/é—œä¿‚ (NPCæƒ…ç·’/é—œä¿‚ç·Šå¼µå¯èƒ½è§¸ç™¼è¡çªäº‹ä»¶)
    - ä¸–ç•Œç‹€æ…‹ (è³‡æºåŒ±ä¹è§¸ç™¼æ¶å¥ª/ç–¾ç—…äº‹ä»¶?)
    - éŠæˆ²é€²ç¨‹/å·²å®Œæˆä»»å‹™ (è§£é–å¾ŒçºŒäº‹ä»¶)
  """;
  event_selection = "å¾æ»¿è¶³è§¸ç™¼æ¢ä»¶çš„ã€äº‹ä»¶åº«ã€‘ä¸­ï¼Œæ ¹æ“šæ¬Šé‡éš¨æ©ŸæŠ½å–ä¸€å€‹äº‹ä»¶ã€‚";
  cooldown = "åŒä¸€äº‹ä»¶æˆ–åŒé¡äº‹ä»¶åœ¨è§¸ç™¼å¾Œï¼Œå¯èƒ½æœƒæœ‰ä¸€å®šçš„å†·å»æ™‚é–“ã€‚";
};;

(* äº‹ä»¶åŸ·è¡Œæµç¨‹ *)
let event_execution_flow = """
  1. äº‹ä»¶è§¸ç™¼æˆåŠŸï¼Œé¸å®šäº‹ä»¶ã€‚
  2. è¨­ç½®äº‹ä»¶å ´æ™¯ï¼Œå‘ˆç¾äº‹ä»¶æè¿°çµ¦ç©å®¶ã€‚
  3. (è‹¥æœ‰) æä¾›ç©å®¶é¸æ“‡é¸é …ã€‚
  4. æ ¹æ“šç©å®¶é¸æ“‡æˆ–äº‹ä»¶å›ºå®šæ•ˆæœï¼ŒåŸ·è¡Œäº‹ä»¶å¾Œæœï¼š
     - æ”¹è®Šè§’è‰²ç‹€æ…‹ (HP/MP/SAN/ç‰©å“...)
     - æ”¹è®Šé—œä¿‚/è²æœ›/é“å¾·
     - è§¸ç™¼æˆ°é¬¥
     - é–‹å§‹/æ›´æ–°ä»»å‹™
     - æ”¹è®Šç’°å¢ƒ/åœ°é»ç‹€æ…‹
     - çµ¦äºˆä¿¡æ¯/ç·šç´¢
  5. äº‹ä»¶çµæŸï¼Œæ¢å¾©æ­£å¸¸éŠæˆ²æµç¨‹ã€‚
"""
;;

(* äº‹ä»¶åº«çµæ§‹å»ºè­° *)
type random_event_choice = {
  text: string;
  condition: string option;
  effects: string list; (* æ•ˆæœæ¨™ç±¤ *)
  next_event_id: string option;
};;

type random_event = {
  event_id: string;
  description: string;
  trigger_conditions: string list;
  weight: float; (* æŠ½ä¸­æ¬Šé‡ *)
  choices: random_event_choice list option; (* è‹¥ç„¡é¸é …å‰‡ç‚ºç›´æ¥ç™¼ç”Ÿäº‹ä»¶ *)
  direct_effects: string list option; (* è‹¥ç„¡é¸é …çš„ç›´æ¥æ•ˆæœ *)
  cooldown_hours: int option;
  tags: string list; (* äº‹ä»¶æ¨™ç±¤ *)
};;

(* (æ¦‚å¿µæ€§) äº‹ä»¶åº« - AI éœ€è¼‰å…¥å¯¦éš›çš„äº‹ä»¶åº«æ–‡ä»¶å…§å®¹ *)
module EventMap = Map.Make(String);;
let random_event_library : random_event EventMap.t ref = ref EventMap.empty;;

(* ç¯„ä¾‹äº‹ä»¶çµæ§‹ *)
let event_find_herb : random_event = {
  event_id = "RE_Find_Rare_Herb_01";
  description = "ä½ åœ¨è·¯é‚Šçš„çŸ³ç¸«ä¸­ï¼Œæ„å¤–ç™¼ç¾äº†ä¸€æ ªå½¢æ…‹å¥‡ç‰¹çš„è—¥è‰ï¼Œä¼¼ä¹é —ç‚ºç½•è¦‹ã€‚";
  trigger_conditions = ["location.tags contains 'é‡å¤–'", "player.skills['è­˜è‰'] >= 3"];
  weight = 1.0; choices = None; direct_effects = Some ["GrantItem(herb_rare_01, 1)"];
  cooldown_hours = Some 168; (* ä¸€å‘¨å†·å» *) tags = ["æ¡é›†", "æ©Ÿé‡", "è‰è—¥"];
};;
(* let () = (* ... å°‡äº‹ä»¶åŠ å…¥äº‹ä»¶åº« ... *) ();; *)

(* ç¯„ä¾‹äº‹ä»¶åº«å¼•ç”¨ (å¯¦éš›æ‡‰å¾æ–‡ä»¶å¤¾è¼‰å…¥) *)
let event_library_files = [
  "ç‡Ÿå¯¨50å°äº‹ä»¶.ini";
  "ç”·å¥³æ„Ÿæƒ…ç¤¾äº¤æ’æ›² 50äº‹ä»¶åº«.ini";
  "50å€‹äº‹ä»¶åº«ç¯„ä¾‹ (Event Library Examples).ini";
  "äººæ‰ç›¸é—œ20äº‹ä»¶.ini";
  "20æ‰­è½‰å½¢è±¡æ©Ÿæœƒäº‹ä»¶åº«.ini";
  (* ... å¯æ“´å±• ... *)
];;

ğŸ”— ä¾è³´æ¨¡çµ„ (Dependencies)
let random_event_depends_on = [
  "world_settings.ml";            (* æä¾›æ™‚é–“ã€åœ°é»ã€å¤©æ°£ä½œç‚ºè§¸ç™¼æ¢ä»¶ *)
  "character_attributes.ml";      (* ç©å®¶ç‹€æ…‹å½±éŸ¿è§¸ç™¼æ¦‚ç‡å’Œäº‹ä»¶æ•ˆæœ *)
  "npc_stats_tracker.ml";         (* NPC ç‹€æ…‹å½±éŸ¿è§¸ç™¼æ¦‚ç‡å’Œäº‹ä»¶æ•ˆæœ *)
  "reputation_system_comprehensive.ml"; (* é—œä¿‚/è²æœ›/é“å¾·ä½œç‚ºæ¢ä»¶æˆ–è¢«äº‹ä»¶å½±éŸ¿ *)
  "quest_event_system.ml";        (* äº‹ä»¶å¯èƒ½è§¸ç™¼æˆ–æ›´æ–°ä»»å‹™ *)
  "item_consumable_system.ml";    (* äº‹ä»¶å¯èƒ½çµ¦äºˆ/ç§»é™¤ç‰©å“ *)
  "combat_system_wuxia.ml";       (* äº‹ä»¶å¯èƒ½è§¸ç™¼æˆ°é¬¥ *)
  "ai_behavior_system.ml";        (* NPC å°äº‹ä»¶çš„åæ‡‰ *)
  "map_exploration_system.ml";    (* åœ°é»è§¸ç™¼ *)
]
;;

(* === End of Dynamic Random Event System definition === *)


(* === ğŸ¤« æµè¨€å…«å¦ å‚³æ’­ç³»çµ±æ¨¡çµ„ (rumor_gossip_system_v1.2.ml) - ä¿®æ­£ç‰ˆ V1.3 === *)

(* ## ğŸ“˜ æ¨¡çµ„èªªæ˜
æœ¬æ¨¡çµ„è² è²¬æ¨¡æ“¬éŠæˆ²ä¸–ç•Œä¸­æµè¨€èœšèªçš„ç”¢ç”Ÿã€å‚³æ’­ã€è®Šç•°å’Œå½±éŸ¿ã€‚å®ƒä½¿ä¸–ç•Œæ›´åŠ ç”Ÿå‹•ï¼ŒNPC ç¤¾ç¾¤å°ç©å®¶çš„è¡Œç‚ºå’Œé‡å¤§äº‹ä»¶ç”¢ç”Ÿå‹•æ…‹åæ‡‰ï¼Œä¸¦å¯èƒ½å½±éŸ¿è²æœ›ã€é—œä¿‚ã€ä»»å‹™è§¸ç™¼ï¼Œç”šè‡³èª¤å°ç©å®¶ã€‚V1.3 ç‰ˆæœ¬é‡é»å¼·åŒ–äº†å…§å®¹ç”Ÿæˆçš„çœŸå¯¦æ€§ï¼Œè¦æ±‚æ ¹æ“šä¿¡æ¯ä¾†æºçš„ç¢ºå®šæ€§èª¿æ•´æªè¾­ã€‚
*)

---

(* ## ğŸ“° æµè¨€æ ¸å¿ƒæ•¸æ“šçµæ§‹ (V1.3 æ›´æ–°) *)

(* --- æµè¨€ä¾†æºé¡å‹ --- *)
type rumor_source_t =
  | DirectWitness     (* ç›´æ¥ç›®æ“Š *)
  | EvidenceDiscovery (* ç™¼ç¾é–“æ¥è­‰æ“š/å¾Œæœ *)
  | Hearsay           (* é“è½å¡—èªªï¼Œè½‰è¿°ä»–äºº *)
  | Speculation       (* åŸºæ–¼è§€å¯Ÿæˆ–å·²æœ‰ä¿¡æ¯çš„çŒœæ¸¬ *)
  | OfficialSource    (* å®˜æ–¹å…¬å‘Šæˆ–å‘½ä»¤ *)
  | Unknown           (* ä¾†æºä¸æ˜ *)
;;

(* æµè¨€æ¢ç›®å®šç¾© *)
type rumor_entry = {
  id : string;                      (* æµè¨€å”¯ä¸€ ID *)

  (** ã€æ ¸å¿ƒä¿®æ”¹ã€‘æµè¨€çš„æ–‡å­—å…§å®¹ã€‚å…¶ç”Ÿæˆé‚è¼¯ï¼ˆè¦‹ä¸‹æ–¹èªªæ˜ï¼‰å°‡åš´æ ¼éµå®ˆï¼š
      åªæœ‰ç•¶ä¾†æºå¯é (å¦‚ DirectWitness)ã€ç¢ºå®šæ€§é«˜(certainty_level >= 0.8)ï¼Œ
      ä¸”æ˜ç¢ºçŸ¥é“è¡Œå‹•è€…(rumor_actor_id = Some ...)æ™‚ï¼Œæ‰å¯ä½¿ç”¨è‚¯å®šèªæ°£æŒ‡å‘ç‰¹å®šäººç‰©ã€‚
      å…¶ä»–æƒ…æ³ä¸‹ï¼ˆä¾†æºä¸å¯é /ç¢ºå®šæ€§ä½/è¡Œå‹•è€…æœªçŸ¥ï¼‰ï¼Œå¿…é ˆä½¿ç”¨æ¨¡ç³Šã€çŒœæ¸¬ã€
      ç–‘å•æˆ–åƒ…æè¿°ç¾è±¡çš„æªè¾­ï¼Œé¿å…ç„¡æ ¹æ“šåœ°æ­¸å’æ–¼äººã€‚
  *)
  content : string;

  source_type : rumor_source_t;     (* ã€æ–°å¢/å¼·èª¿ã€‘æµè¨€ä¾†æºé¡å‹ *)
  source : string option;           (* æœ€åˆä¿¡æ¯ä¾†æºæè¿° (NPC ID / äº‹ä»¶ ID / "æœªçŸ¥" / "æ“šèªª...") *)
  origin_event_id : string option;  (* é—œè¯çš„èµ·æºäº‹ä»¶ ID *)
  topic_entity_id : string;         (* æµè¨€ä¸»é¡Œå¯¦é«” (PC ID / NPC ID / åœ°é» ID / ç‰©å“ ID / äº‹ä»¶é—œéµè©) *)
  topic_category : string;          (* ä¸»é¡Œåˆ†é¡ (å€‹äººè¡Œç‚º / èƒ½åŠ›è©•åƒ¹ / æƒ…æ„Ÿé—œä¿‚ / è³‡æºç‹€æ³ / ç‡Ÿå¯¨äº‹å‹™ / å¤–éƒ¨å¨è„… ç­‰) *)
  spread_level : string;            (* ç•¶å‰å‚³æ’­ç¯„åœ (æœ¬åœ°/å€åŸŸ/å»£æ³›) *)
  current_believability : float;    (* ç•¶å‰å¯ä¿¡åº¦è©•ä¼° (0.0 - 1.0), å—å‚³æ’­å’Œè­‰æ“šå½±éŸ¿ *)
  certainty_level : float;          (* ã€æ–°å¢/å¼·èª¿ã€‘ä¿¡æ¯æœ¬èº«çš„ç¢ºå®šæ€§ (0.0 - 1.0), ä¸åŒæ–¼å¯ä¿¡åº¦ï¼ŒæŒ‡ä¿¡æ¯æºå°å…§å®¹çš„ç¢ºä¿¡ç¨‹åº¦ *)
  veracity : string option;         (* çœŸå¯¦æ€§åˆ¤æ–· ("å±¬å¯¦" / "éƒ¨åˆ†å±¬å¯¦" / "è™›å‡" / "æœªçŸ¥") - GM/ç³»çµ±å…§éƒ¨åˆ¤æ–· *)
  positive_spin_variant : string option; (* æ­£é¢æ¼”ç¹¹çš„ç‰ˆæœ¬ *)
  negative_spin_variant : string option; (* è² é¢æ¼”ç¹¹çš„ç‰ˆæœ¬ *)
  impact_tags : string list;        (* æµè¨€å¯èƒ½ç”¢ç”Ÿçš„å½±éŸ¿æ¨™ç±¤ *)

  (* ã€æ–°å¢/ç´°åŒ–ã€‘ç”¨æ–¼å…§å®¹ç”Ÿæˆå’Œè®Šç•°çš„é—œéµç´°ç¯€ *)
  rumor_action : string option;       (* æµè¨€æè¿°çš„é—œéµå‹•ä½œ/äº‹ä»¶ *)
  rumor_actor_id : string option;     (* æµè¨€ä¸­çš„è¡Œå‹•è€… (å¦‚æœèƒ½ç›¸å°ç¢ºå®š) *)
  rumor_target_id : string option;    (* æµè¨€ä¸­çš„ç›®æ¨™/å—å½±éŸ¿è€… *)
  rumor_location_id : string option;  (* æµè¨€äº‹ä»¶ç™¼ç”Ÿåœ°é» *)
  key_details : (string * string) list; (* æµè¨€åŒ…å«çš„å…¶ä»–é—œéµç´°ç¯€ï¼ˆç”¨æ–¼è®Šç•°å’ŒæŸ¥è©¢ï¼‰ *)

  active_status : bool;             (* æ˜¯å¦ä»åœ¨æ´»èºå‚³æ’­ *)
  creation_round : int option;      (* ç”¢ç”Ÿå›åˆæ•¸ *)
  last_spread_round : int option;   (* ä¸Šæ¬¡å‚³æ’­å›åˆæ•¸ *)
};;

(* (æ¦‚å¿µæ€§) æµè¨€è³‡æ–™åº« *)
module RumorMap = Map.Make(String);;
let rumor_database : rumor_entry RumorMap.t ref = ref RumorMap.empty;;

(* ç¯„ä¾‹æµè¨€ (ä¿®æ­£ç‰ˆ) *)
let rumor_example_pc_feat_modified : rumor_entry = {
  id="RUMOR_911_01_MODIFIED";
  content="**ã€é©šå¤©å‚³èï¼ã€‘è½é‚£äº›å¾å¾Œå±±å’Œç¤¦æ´å›ä¾†çš„å…„å¼Ÿå€‘èªªï¼Œå’±å€‘å¤§ç•¶å®¶ç°¡ç›´æ˜¯å¤©ç¥ä¸‹å‡¡ï¼æœ‰äººèªªçœ‹åˆ°ä»–ä¸€åˆ€å°±æŠŠåˆæŠ±ç²—çš„å¤§æ¨¹çµ¦åŠˆäº†ï¼Œé‚„æœ‰äººèªªä»–åœ¨ç¤¦æ´è£¡çªä¸€çœ¼ï¼ŒçŸ³é ­å°±è‡ªå·±å˜©å•¦å•¦æ‰ä¸‹ä¾†ï¼é€™ä¹Ÿå¤ªç„ä¹äº†å§ï¼Ÿ**"; (* ä¿®æ”¹æªè¾­ï¼Œå¼·èª¿æ˜¯â€œè½èªªâ€ã€â€œæœ‰äººèªªâ€ï¼Œèªæ°£å¸¶æœ‰èª‡å¼µå’Œç–‘å• *)
  source_type = Hearsay; (* ä¸»è¦ä¾†æºæ˜¯å£è€³ç›¸å‚³ï¼Œç¶“éäº†å¤šé‡åŠ å·¥ *)
  source=Some "å˜å›‰/ç¤¦å·¥å£å‚³(å¤šé‡å¤±çœŸ)"; origin_event_id=Some "R892/R896";
  topic_entity_id="player_azhai"; topic_category="èƒ½åŠ›è©•åƒ¹";
  spread_level="å»£æ³›(å¯¨å…§)"; current_believability=0.4; certainty_level = 0.3; (* ä¾†æºæœ¬èº«ç¢ºå®šæ€§ä¸é«˜ *)
  veracity=Some "æ¥µåº¦èª‡å¼µ";
  positive_spin_variant=Some "å¤§ç•¶å®¶çœŸä¹ƒå¤©ç¥ä¸‹å‡¡ï¼Œæœ‰ä»–åœ¨æ­¤ï¼Œé»‘é¢¨å¯¨ç„¡æ†‚çŸ£ï¼";
  negative_spin_variant=Some "å¤§ç•¶å®¶æ‰‹æ®µå¦‚æ­¤é§­äººï¼Œæ€•ä¸æ˜¯ä»€éº¼å¦–é­”å§ï¼Ÿå’±å€‘è·Ÿè‘—ä»–çœŸçš„å®‰å…¨å—ï¼Ÿ";
  impact_tags=["æå‡PCæ•¬ç•åº¦(ç¥åŒ–/ç•æ‡¼)", "é™ä½å˜å›‰ä¸»å‹•æ€§?", "å¼•ç™¼ç®¡ç†å±¤ä¸å®‰"];
  rumor_action = Some "æ–½å±•äº†è¶…ä¹å¸¸äººçš„åŠ›é‡(ä¼æœ¨/ç¢å²©)"; rumor_actor_id = Some "player_azhai"; rumor_target_id = None; rumor_location_id = Some "å¾Œå±±/ç¤¦æ´";
  key_details=[("åœ°é»","å¾Œå±±/ç¤¦æ´");("è¡Œç‚º","ä¼æœ¨/ç¢å²©");("æ•ˆæœ","è¶…è‡ªç„¶")]; active_status=true; creation_round=Some 892; last_spread_round=Some 911;
};;
(* let () = (* ... Add rumor to database ... *) ();; *)


(* --- ğŸ”„ æµè¨€ç”Ÿå‘½é€±æœŸï¼šç”¢ç”Ÿã€å‚³æ’­èˆ‡è®Šç•° (V1.3 è¦å‰‡èªªæ˜æ›´æ–°) --- *)
let rumor_lifecycle = {
  generation_triggers = [
    "ç©å®¶åŸ·è¡Œäº†ã€å¼•äººæ³¨ç›®ã€‘çš„è¡Œç‚º (æˆåŠŸ/å¤±æ•—/ç‰¹æ®Š)";
    "ç™¼ç”Ÿäº†ã€é‡å¤§äº‹ä»¶ã€‘ (æˆ°é¬¥/å»ºè¨­/å¤–äº¤/ç½é›£/å®´å¸­)";
    "NPC ä¹‹é–“çš„ã€ç§˜å¯†äº’å‹•ã€‘è¢«çªºè¦–æˆ–æ³„éœ²";
    "NPC åŸºæ–¼è‡ªèº«ã€æƒ…ç·’/é—œä¿‚/æ€§æ ¼ã€‘ä¸»å‹•æ•£ä½ˆ (å¯èƒ½åŒ…å«åè¦‹æˆ–è¬Šè¨€)";
    "ä»»å‹™çå‹µ/æ‡²ç½°ä¸­åŒ…å«ã€æ•£ä½ˆ/æ¾„æ¸…ã€‘æµè¨€";
    "å¤–éƒ¨å‚³å…¥çš„ä¿¡æ¯ (ç½•è¦‹)";
    "**ã€é‡è¦ã€‘ç™¼ç¾äº†æŸå€‹äº‹ä»¶çš„ã€é–“æ¥è­‰æ“šæˆ–å¾Œæœã€‘(å¦‚å±é«”ã€å¤±è¹¤ã€è³‡æºç•°å¸¸è®ŠåŒ–)**"; (* æ–°å¢å¼·èª¿ *)
    "**ã€é‡è¦ã€‘NPC åŸºæ–¼ç¾æœ‰ä¿¡æ¯é€²è¡Œã€ä¸»è§€æ¨æ¸¬æˆ–è¯æƒ³ã€‘**"; (* æ–°å¢å¼·èª¿ *)
  ];

  (** ã€V1.3 æ ¸å¿ƒè¦å‰‡ï¼šå…§å®¹ç”Ÿæˆæº–å‰‡ã€‘**)
  content_generation_rule = """
    ç³»çµ±åœ¨ç”Ÿæˆ `content` å­—æ®µæ™‚ï¼Œå¿…é ˆæ ¹æ“š `source_type`, `certainty_level` å’Œ `rumor_actor_id` é€²è¡Œåˆ¤æ–·ï¼š
    1. **é«˜ç¢ºå®šæ€§ + æ˜ç¢ºè¡Œå‹•è€…:** ç•¶ä¾†æºå¯é ï¼ˆå¦‚ DirectWitness, OfficialSourceï¼‰ï¼Œç¢ºå®šæ€§é«˜ï¼ˆå¦‚ >= 0.8ï¼‰ï¼Œä¸”è¡Œå‹•è€…æ˜ç¢ºæ™‚ï¼Œå…§å®¹å¯ä½¿ç”¨è¼ƒè‚¯å®šèªæ°£æè¿°äº‹ä»¶å’Œäººç‰©ã€‚
    2. **ä½ç¢ºå®šæ€§ / æœªçŸ¥è¡Œå‹•è€… / çŒœæ¸¬ / å‚³è:** åœ¨å…¶ä»–æ‰€æœ‰æƒ…æ³ä¸‹ï¼Œå…§å®¹**å¿…é ˆ**ä½¿ç”¨æ¨¡ç³Šã€ä¸ç¢ºå®šã€ç–‘å•æˆ–åƒ…æè¿°ç¾è±¡çš„æªè¾­ã€‚ä¾‹å¦‚ï¼š
        - ä½¿ç”¨å¼•å°è©: "è½èªª...", "å¥½åƒ...", "æ“šèªª...", "æœ‰äººçœ‹åˆ°...", "å¯¨å­è£¡éƒ½åœ¨å‚³..."
        - è¡¨é”ä¸ç¢ºå®š: "...ä¸çŸ¥é“æ˜¯èª°å¹¹çš„?", "...æ˜¯ä¸æ˜¯çœŸçš„?", "...æ€éº¼å›äº‹?", "...é›£é“æ˜¯...?"
        - å´é‡æè¿°ç¾è±¡è€Œéæ­¸å› : "ä¼™æˆ¿å°‘äº†åƒçš„" (è€Œä¸æ˜¯"XXå·äº†åƒçš„")ï¼›"å¾Œå±±æœ‰æ‰“é¬¥è²" (è€Œä¸æ˜¯"XXå’ŒXXæ‰“èµ·ä¾†äº†")ï¼›"æŸäººæˆ¿è£¡ç‡ˆäº®åˆ°å¾ˆæ™š" (è€Œä¸æ˜¯"æŸäººåœ¨ç†¬å¤œåšæŸäº‹")ã€‚
    3. **æ¼”ç¹¹ç‰ˆæœ¬:** `positive_spin_variant` å’Œ `negative_spin_variant` å­—æ®µç”¨æ–¼è¨˜éŒ„åŒä¸€äº‹ä»¶å¯èƒ½ç”¢ç”Ÿçš„ä¸åŒä¸»è§€è§£è®€ï¼Œå…¶æªè¾­ä¹Ÿæ‡‰éµå¾ªç›¸æ‡‰é‚è¼¯ã€‚
    **ã€æœ€çµ‚ç›®æ¨™ã€‘:** ç¢ºä¿æµè¨€å…§å®¹çš„å‘ˆç¾æ–¹å¼èˆ‡å…¶ä¿¡æ¯çš„å¯é åº¦å’Œä¾†æºç›¸åŒ¹é…ï¼Œé¿å…åœ¨ç¼ºä¹è­‰æ“šæ™‚åšå‡ºä¸åˆç†çš„æ–·è¨€ã€‚
  """;

  spread_mechanics = { (* å‚³æ’­æ©Ÿåˆ¶ä¿æŒ V1.2 *)
    interval = "æ¯æ—¥/æ¯å¹¾å°æ™‚";
    method_ = "åŸºæ–¼ã€åœ°é»äººç¾¤å¯†åº¦ã€‘ã€ã€NPCç¤¾äº¤æ´»èºåº¦ã€‘å’Œã€æµè¨€å¸å¼•åº¦ã€‘é€²è¡Œæ¦‚ç‡æ€§å‚³æ’­";
    range_expansion = "æœ¬åœ° -> å€åŸŸ -> å»£æ³›";
    spread_probability_factors = [
      ("æµè¨€ã€å¸å¼•åº¦ã€‘", "+"); ("ã€ä¿¡æ¯æºã€‘æ¬Šå¨æ€§/å¯ä¿¡åº¦", "+"); ("ã€å‚³æ’­è€…ã€‘ç¤¾äº¤èƒ½åŠ›", "+");
      ("ã€åœ°é»ã€‘äººç¾¤èšé›†åº¦", "+"); ("ã€æ™‚é–“ã€‘æµé€", "+"); ("ã€å®˜æ–¹æ…‹åº¦ã€‘", "-/+"); ("ã€å·²æœ‰åè­‰ã€‘", "- -");
    ];
  };

  mutation_mechanics = { (* è®Šç•°æ©Ÿåˆ¶ä¿æŒ V1.2 *)
    trigger_chance_per_spread = 0.15;
    mutation_types = ["ç´°ç¯€ä¸Ÿå¤±/æ¨¡ç³ŠåŒ–"; "ç´°ç¯€èª‡å¤§/æ‰­æ›²"; "æ·»åŠ ä¸»è§€è‡†æ¸¬"; "å¼µå† ææˆ´"; "ç”¢ç”Ÿæ­£/è² é¢æ¼”ç¹¹"; "åˆä½µ/æ‹†åˆ†æµè¨€"];
    mutation_factors = ["å‚³æ’­éˆé•·åº¦"; "å‚³æ’­è€…ç†è§£/è¨˜æ†¶/ç«‹å ´"];
    mutation_outcome = "å¯èƒ½ç”Ÿæˆæ–°çš„ã€è®Šç¨®æµè¨€æ¢ç›®ã€‘ï¼Œæˆ–ä¿®æ”¹åŸæµè¨€ã€å…§å®¹/å¯ä¿¡åº¦ã€‘";
  };

  fade_mechanics = { (* è¡°æ¸›æ©Ÿåˆ¶ä¿æŒ V1.2 *)
    trigger_conditions = ["é•·æ™‚é–“ç„¡æ–°å‚³æ’­"; "å‡ºç¾å¼·åŠ›åè­‰"; "è¢«å®˜æ–¹é—¢è¬ "; "è¢«æ–°ç†±é»å–ä»£"];
    fade_process = "é™ä½æ´»èºç‹€æ…‹ -> é™ä½å¯ä¿¡åº¦ -> ç§»å‡ºæ´»èºåº«";
  };
};;

(* --- ğŸ¯ æµè¨€çš„å½±éŸ¿èˆ‡æ‡‰ç”¨ (V1.2 è£œå……) --- *)
let rumor_impacts = [
  "å½±éŸ¿ã€è²æœ›/è©•åƒ¹ã€‘ (reputation_system)";
  "å½±éŸ¿ã€äººéš›é—œä¿‚ã€‘ (å°æµè¨€ä¸»è§’æˆ–å‚³æ’­è€…çš„å¥½æ„Ÿ/ä¿¡ä»»)";
  "å½±éŸ¿ã€NPCæƒ…ç·’/è¡Œç‚ºã€‘ (ai_behavior)";
  "è§¸ç™¼ã€æ–°ä»»å‹™/äº‹ä»¶ã€‘ (quest_event)";
  "æä¾›ã€ä¿¡æ¯/ç·šç´¢ã€‘ (**å¯èƒ½æ˜¯éŒ¯èª¤çš„!**)"; (* å¼·èª¿ä¸ç¢ºå®šæ€§ *)
  "å¡‘é€ ã€å…¬çœ¾è¼¿è«–ã€‘å’Œã€å£«æ°£ã€‘ (settlement_data)";
  "ç©å®¶å¯åˆ©ç”¨/æ•£ä½ˆ/æ¾„æ¸…æµè¨€ä½œç‚ºã€ç­–ç•¥æ‰‹æ®µã€‘";
];;

(* --- ğŸ”— ä¾è³´æ¨¡çµ„ (Dependencies) --- *)
let rumor_depends_on = [
  "npc_stats_tracker.ml";
  "reputation_system_comprehensive.ml";
  "ai_behavior_system.ml";
  "quest_event_system.ml";
  "world_settings.ml";
  "emotion_psychology.ml";
  "text_generation_helper.ml"; (* (æ–°å¢) å¯èƒ½éœ€è¦ä¸€å€‹è¼”åŠ©æ¨¡çµ„ä¾†ç”Ÿæˆæ›´è‡ªç„¶çš„æ¨¡ç³Š/çŒœæ¸¬æ€§èªå¥ *)
]
;;

(* === End of Rumor & Gossip System definition (V1.3 Revised) === *)


(* ============================================================ *)
(* ==   åˆä½µæ¨¡çµ„ Part 9: å‹•æ…‹åŠ‡æƒ…é©…å‹• (Dynamic Systems) çµæŸ   == *)
(* ============================================================ *)