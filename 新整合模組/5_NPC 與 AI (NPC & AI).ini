(* ============================================================ *)
(* ==          åˆä½µæ¨¡çµ„ Part 5: NPC èˆ‡ AI (NPC & AI)          == *)
(* ============================================================ *)

(* === Content from: ğŸ§¬ è§’è‰²å±¬æ€§èˆ‡ç‹€æ…‹æ¨¡çµ„ (character_attributes.ml).ini (NPC Profile Structure Definition éƒ¨åˆ†) === *)
(* Modifications/Additions for npc_profile_t structure *)

(* åŸºç¤å±¬æ€§é¡å‹ *)
type base_attributes_t = { str: int; agi: int; int_: int; cha: int; lck: int };;

(* ä»»å‹™å¿«ç…§é¡å‹ (ä¾› NPC assigned_tasks ä½¿ç”¨) *)
type quest_objective_t = { description : string; status : string; notes: string option };;
type quest_snapshot_t = { quest_id : string; quest_name : string; status : string; current_stage : int option; objectives : quest_objective_t list; key_npc_ids : string list option; assigned_to_id: string option; priority: int option; notes : string option; };;


(* é—œä¿‚æ¨™è¨˜é¡å‹ *)
type relationship_flag_t =
  | Subordinate of string (* e.g., "confirmed(é†«è­·ç¸½ç®¡)" *)
  | Colleague of string
  | Family of string (* e.g., "éºå­€(å‘¨çµ±é ˜)" *)
  | Enemy of string (* e.g., "captured_by_bwf(Former)" *)
  | Ally of string
  | Romantic of string
  | Witnessed of string (* e.g., "PC_Medical_Intervention(Multiple)" *)
  | TaskedWith of string (* e.g., "caring_for_XiaoCui" *)
  | HasHistory of string (* e.g., "SurrenderedToPC" *)
  | Aware of string (* e.g., "NewAppointments" *)
  | Flag of string (* é€šç”¨æ¨™è¨˜ e.g., "RecentlyReprimanded", "UnderHighPressure" *)
  | LoveAtFirstSight of string (* æ–°å¢: å°ç‰¹å®šç›®æ¨™ä¸€è¦‹é¾æƒ… *)
  | HiddenIdentity of string (* æ–°å¢: éš±è—èº«ä»½é¡å‹ *)
  | PassiveAbility of string (* æ–°å¢: è¢«å‹•èƒ½åŠ›æ¨™è¨˜ *)
  | BehaviorGoal of string (* æ–°å¢: è¡Œç‚ºç›®æ¨™ *)
  | Relationship of (string * relationship_record) (* æ–°å¢: è¨˜éŒ„å°å…¶ä»–NPCçš„é—œä¿‚ *)
and relationship_record = { (* Note: Recursive type definition needs careful handling in OCaml *)
  affinity: float;
  enmity: float;
  trust: float;
  respect: float;
  flags: relationship_flag_t list;
};;

(* NPC å° PC çš„é—œä¿‚å¿«ç…§ *)
type npc_relationship_snapshot_t = {
  core_emotion : string list;
  affinity_towards_pc : float;
  enmity_towards_pc : float;
  trust_level_towards_pc : float;
  respect_level_towards_pc : float;
  obligation_towards_pc : float;
  relationship_flags : relationship_flag_t list; (* ä½¿ç”¨ä¸Šæ–¹å®šç¾©çš„é¡å‹ *)
};;

(* NPC è²æœ›èˆ‡é™£ç‡Ÿå¿«ç…§ *)
type npc_reputation_snapshot_t = {
  jianghu_fame_level : string option;
  faction_standing : (string * float) list option;
  morality_level : string option;
};;

(* NPC æŠ€èƒ½å¿«ç…§ *)
type npc_skill_snapshot_t = {
  skill_id: string;
  name: string;
  level: int option;
  mastery: string option;
  proficiency: float option;
};;

(* NPC èƒ½åŠ›å¿«ç…§ *)
type npc_abilities_snapshot_t = {
  overall_estimate : string;
  key_skills : npc_skill_snapshot_t list option;
  special_abilities : string list option;
};;


(** NPC å®Œæ•´æª”æ¡ˆçµæ§‹ - åŒ…å«æ‰€æœ‰æ–°å¢å­—æ®µ *)
type npc_profile_t = {
  id : string; name : string;

  basic_info : {
    surname: string option;            (* å§“æ° *)
    given_name: string option;         (* åå­— *)
    nickname: string option;    (* ç¶½è™Ÿ/æ±Ÿæ¹–ç¨±è™Ÿ *)
    generation: int option;     (* è¼©åˆ† *)
    hometown_id: string option; (* ç±è²«/å®¶é„‰åœ°é»ID *)
    occupation_identity : string; race : string; faction_or_sect : string option; estimated_age : string;
    personality_traits : string list };

  current_state : {
    alive_status : string;
    location_id : string;
    location_name : string;
    action_intention : string;
    current_routine_phase: string option; (* ç•¶å‰æ‰€è™•çš„ä½œæ¯/æ—¥ç¨‹éšæ®µ *)
  };
  appearance_description : string;
  relationships : npc_relationship_snapshot_t; (* å° PC çš„é—œä¿‚ *)
  knowledge : string list;
  abilities : npc_abilities_snapshot_t;
  equipment_and_items : {
    known_equipment : string list;
    key_items : string list (* é€™è£¡çš„ key_items å¯èƒ½æ˜¯æŒ‡éœ€è¦è¿½è¹¤çš„ç‰¹æ®Šç‰©å“ï¼Œå¯¦éš›ç‰©å“åœ¨ inventory ä¸­ *)
  };
  conditions : string list;
  memory_tags : string list;
  reputation_and_alignment : npc_reputation_snapshot_t;
  estimated_base_attributes : base_attributes_t * string; (* ä¼°ç®—çš„åŸºç¤å±¬æ€§åŠèªªæ˜ *)

  clan_id: string option;                   (* æ‰€å±¬å®—æ—/å®¶æ— ID *)
  known_kinship_links: (string * string * float) list option; (* å·²çŸ¥çš„è¦ªç·£é—œä¿‚åˆ—è¡¨ (NPC_ID, é—œä¿‚é¡å‹, è¦ªå¯†åº¦) *)
  potential_family_talent: string option; (* æ½›åœ¨çš„å®¶æ—ç‰¹æ®Šå¤©è³¦/ç‰¹è³ªåç¨± *)

  trait_tags : string list; (* ç¸½çµæ€§çš„ç‰¹å¾µæ¨™ç±¤ *)
  assigned_tasks : quest_snapshot_t list option; (* ç•¶å‰è¢«æŒ‡æ´¾çš„ä»»å‹™ *)
};;


(* === Content from: ğŸ¤– AI è¡Œç‚ºç³»çµ±æ¨¡çµ„ (ai_behavior_system.ml).ini === *)

# ğŸ¤– AI è¡Œç‚ºç³»çµ±æ¨¡çµ„ (ai_behavior_system.ml)

## ğŸ“˜ æ¨¡çµ„èªªæ˜
æœ¬æ¨¡çµ„è² è²¬å®šç¾©éç©å®¶è§’è‰² (NPC) çš„è¡Œç‚ºé‚è¼¯ã€æ±ºç­–æµç¨‹å’Œå°ç’°å¢ƒåŠç©å®¶äº’å‹•çš„åæ‡‰ã€‚å®ƒæ—¨åœ¨é©…å‹• NPC é€²è¡Œæ›´çœŸå¯¦ã€å‹•æ…‹çš„æ´»å‹•ï¼Œè€Œä¸åƒ…åƒ…æ˜¯è¢«å‹•ç­‰å¾…è§¸ç™¼ã€‚æœ¬æ¨¡çµ„å°‡èˆ‡ NPC ç‹€æ…‹ã€æƒ…ç·’ã€æŠ€èƒ½ã€ä»»å‹™ã€åœ°åœ–æ¢ç´¢ã€ä¸–ç•Œè¨­å®šç­‰æ¨¡çµ„ç·Šå¯†äº’å‹•ã€‚

---

## ğŸ§  æ±ºç­–æ¡†æ¶ï¼šéœ€æ±‚-ç›®æ¨™-è¡Œå‹• å¾ªç’° (Needs-Goals-Actions Cycle)
```ml
(* æ¦‚å¿µæ€§æè¿° AI é©…å‹• NPC è¡Œç‚ºçš„æ ¸å¿ƒé‚è¼¯ *)
let ai_decision_process = {
  step1_assessment = """
  **ç‹€æ…‹è©•ä¼° (State Assessment):**
  - æª¢æŸ¥ NPC çš„æ ¸å¿ƒç‹€æ…‹ (ä¾†è‡ª npc_stats_tracker.ml, survival_status.ml, disease_injury_system.ml, emotion_psychology.ml)ï¼š
    - ç”Ÿç†éœ€æ±‚ï¼šé£¢é¤“ã€å£æ¸´ã€ç–²å‹ã€å‚·ç—…ç‹€æ³ã€‚
    - å®‰å…¨éœ€æ±‚ï¼šæ˜¯å¦è™•æ–¼å±éšªä¸­ (æˆ°é¬¥ã€ç’°å¢ƒç½å®³)ï¼Ÿ
    - å¿ƒç†ç‹€æ…‹ï¼šç•¶å‰æƒ…ç·’ã€å£“åŠ›æ°´å¹³ã€‚
    - ç¤¾æœƒç‹€æ…‹ï¼šèˆ‡é™„è¿‘ NPC / ç©å®¶çš„é—œä¿‚ã€‚
    - ä»»å‹™ç‹€æ…‹ï¼šæ˜¯å¦æœ‰æœªå®Œæˆçš„ä»»å‹™ (quest_event_system.ml) æˆ–æŒ‡æ´¾çš„å·¥ä½œ (settlement_data.tasks)ã€‚
  """;
  step2_goal_selection = """
  **ç›®æ¨™é¸æ“‡ (Goal Selection):**
  - æ ¹æ“šç‹€æ…‹è©•ä¼°çµæœï¼Œç¢ºå®šç•¶å‰æœ€å„ªå…ˆçš„ç›®æ¨™ (Goal)ã€‚
  - å„ªå…ˆç´šç¯„ä¾‹ (å¯èª¿æ•´)ï¼š
    - **æœ€é«˜ï¼š** ç·Šæ€¥å±éšªæ‡‰å° (é€ƒé›¢è‡´å‘½å¨è„…ã€æ’²æ»…è¿‘èº«ç«ç„°)ã€‚
    - **é«˜ï¼š** æ»¿è¶³åš´é‡ç”Ÿç†éœ€æ±‚ (ç€•æ­»æ²»ç™‚ã€æ¥µåº¦é£¢æ¸´ç–²å‹)ã€‚
    - **ä¸­é«˜ï¼š** åŸ·è¡Œç•¶å‰é—œéµä»»å‹™/æŒ‡æ´¾å·¥ä½œã€‚
    - **ä¸­ï¼š** æ‡‰å°ä¸­ç­‰ç¨‹åº¦çš„ç”Ÿç†éœ€æ±‚ã€è™•ç†å‚·ç—…ã€éŸ¿æ‡‰é‡è¦ NPC äº’å‹•ã€‚
    - **ä¸­ä½ï¼š** éµå¾ªæ—¥å¸¸å®‰æ’ (å·¥ä½œã€å·¡é‚ã€è¨“ç·´)ã€‚
    - **ä½ï¼š** ç¤¾äº¤äº’å‹•ã€æ»¿è¶³æ¬¡è¦éœ€æ±‚ã€æ¢ç´¢ã€ä¼‘æ¯ã€‚
    - **æœ€ä½ï¼š** ç©ºé–’ (Idle)ã€‚
  - **ä¿®æ­£å› å­ï¼š** NPC çš„æ€§æ ¼ (personality_traits)ã€è§’è‰²å®šä½ (occupation_identity)ã€ç•¶å‰æƒ…ç·’æœƒå½±éŸ¿ç›®æ¨™çš„é¸æ“‡å’Œå„ªå…ˆç´šï¼ˆä¾‹å¦‚ï¼šæ‡¶æƒ°çš„ NPC å¯èƒ½æœƒå„ªå…ˆé¸æ“‡ä¼‘æ¯è€Œéå·¥ä½œï¼‰ã€‚
  """;
  step3_action_planning = """
  **è¡Œå‹•è¦åŠƒ (Action Planning):**
  - ç‚ºé¸å®šçš„ç›®æ¨™åˆ¶å®šä¸€ç³»åˆ—å…·é«”çš„è¡Œå‹•æ­¥é©Ÿ (Actions)ã€‚
  - ç¯„ä¾‹ï¼š
    - ç›®æ¨™ï¼šã€æ¸›å°‘é£¢é¤“ã€‘ -> è¡Œå‹•ï¼š[æª¢æŸ¥èƒŒåŒ…æ˜¯å¦æœ‰é£Ÿç‰©] -> [è‹¥ç„¡ï¼Œç§»å‹•åˆ°ä¼™æˆ¿/å¸‚é›†] -> [ç²å–é£Ÿç‰©(é ˜å–/è³¼è²·/è£½ä½œ/å·ç«Š)] -> [é€²é£Ÿ]ã€‚
    - ç›®æ¨™ï¼šã€åŸ·è¡Œå·¡é‚ä»»å‹™ã€‘ -> è¡Œå‹•ï¼š[ç§»å‹•åˆ°æŒ‡å®šå·¡é‚è·¯ç·šèµ·é»] -> [æ²¿è·¯ç·šç§»å‹•] -> [è§€å¯Ÿå‘¨åœç’°å¢ƒ] -> [é‡è¤‡]ã€‚
    - ç›®æ¨™ï¼šã€é€ƒé›¢æˆ°é¬¥ã€‘ -> è¡Œå‹•ï¼š[è©•ä¼°é€ƒè·‘è·¯ç·š] -> [ä½¿ç”¨è¼•åŠŸ/ç§»å‹•æŠ€èƒ½] -> [ç§»å‹•åˆ°å®‰å…¨å€åŸŸ]ã€‚
  """;
  step4_action_execution = """
  **è¡Œå‹•åŸ·è¡Œ (Action Execution):**
  - å˜—è©¦åŸ·è¡Œè¨ˆåŠƒä¸­çš„ç¬¬ä¸€å€‹è¡Œå‹•ã€‚
  - èª¿ç”¨ç›¸é—œæ¨¡çµ„é€²è¡Œåˆ¤å®šï¼šç§»å‹•(map_exploration)ã€ç‰©å“(item_consumable)ã€æŠ€èƒ½(skills_proficiency)ã€æˆ°é¬¥(combat_system)ã€äº’å‹•(reputation_system)ç­‰ã€‚
  - æ ¹æ“šè¡Œå‹•çµæœæ›´æ–° NPC ç‹€æ…‹å’Œä¸–ç•Œç‹€æ…‹ã€‚
  """;
  step5_re_evaluation = """
  **é‡æ–°è©•ä¼° (Re-evaluation):**
  - è¡Œå‹•å®Œæˆæˆ–è¢«æ‰“æ–·å¾Œï¼Œè¿”å›æ­¥é©Ÿ 1ï¼Œæ ¹æ“šæ–°çš„ç‹€æ…‹é‡æ–°è©•ä¼°ä¸¦é¸æ“‡ä¸‹ä¸€å€‹ç›®æ¨™æˆ–è¡Œå‹•ã€‚
  - è‹¥å¤–éƒ¨ç’°å¢ƒç™¼ç”Ÿé‡å¤§è®ŠåŒ–ï¼ˆå¦‚é­é‡æ•µäººã€æ”¶åˆ°å‘½ä»¤ã€è§¸ç™¼äº‹ä»¶ï¼‰ï¼Œæ‡‰ç«‹å³ä¸­æ–·ç•¶å‰è¡Œå‹•ä¸¦é‡æ–°è©•ä¼°ã€‚
  """;
}
;;

---

## ğŸš¶â€â™€ï¸ è¡Œç‚ºç‹€æ…‹èˆ‡åæ‡‰æ¨¡å¼ (Behavioral States & Reaction Patterns)

(* NPC å¯èƒ½è™•æ–¼çš„å¸¸è¦‹è¡Œç‚ºç‹€æ…‹ï¼Œå½±éŸ¿å…¶å°åˆºæ¿€çš„åæ‡‰æ–¹å¼ *)
let common_behavioral_states = [
  ("ç©ºé–’ (Idle)", "ç„¡ç‰¹å®šç›®æ¨™ï¼Œå¯èƒ½é–’é€›ã€è§€å¯Ÿã€‚åæ‡‰è¼ƒæ…¢ã€‚");
  ("ç§»å‹•ä¸­ (Traveling)", "æœ‰æ˜ç¢ºç›®çš„åœ°ï¼Œå¿½ç•¥æ¬¡è¦å¹²æ“¾ã€‚");
  ("å·¥ä½œä¸­/åŸ·è¡Œä»»å‹™ (Working/ExecutingTask)", "å°ˆæ³¨ç›®æ¨™ï¼Œè¢«æ‰“æ–·å¯èƒ½ä¸æ»¿ã€‚");
  ("ä¼‘æ¯ä¸­/ç¡çœ ä¸­ (Resting/Sleeping)", "æ¢å¾©ç‹€æ…‹ï¼Œåæ‡‰é²éˆæˆ–ç„¡ã€‚");
  ("é€²é£Ÿ/é£²æ°´ä¸­ (Eating/Drinking)", "æ»¿è¶³éœ€æ±‚ï¼Œä¸å¸Œæœ›è¢«æ‰“æ“¾ã€‚");
  ("ç¤¾äº¤ä¸­ (Socializing)", "å°è©±ã€äº¤æ˜“ç­‰äº’å‹•ã€‚");
  ("å·¡é‚ä¸­ (Patrolling)", "æ²¿è·¯ç·šç§»å‹•ä¸¦è­¦æˆ’ï¼Œåæ‡‰æ•æ„Ÿã€‚");
  ("è¨“ç·´ä¸­ (Training)", "ç·´ç¿’æŠ€èƒ½ã€‚");
  ("è·Ÿéš¨ä¸­ (Following)", "è·Ÿéš¨æŒ‡å®šç›®æ¨™ã€‚");
  ("æˆ°é¬¥ä¸­ (Fighting)", "åƒèˆ‡æˆ°é¬¥ï¼Œæ±ºç­–ç”±æˆ°é¬¥æ¨¡çµ„æ¥ç®¡ã€‚");
  ("é€ƒè·‘ä¸­ (Fleeing)", "å¿«é€Ÿé é›¢å±éšªï¼Œå¿½ç•¥å…¶ä»–ã€‚");
  ("æœç´¢ä¸­ (Searching)", "å°‹æ‰¾ç‰¹å®šç›®æ¨™ã€‚");
  ("éš±è—ä¸­ (Hiding)", "èº²é¿å¨è„…æˆ–è§€å¯Ÿè€…ã€‚");
  ("å—å‚·/ç”Ÿç—… (Injured/Sick)", "è¡Œå‹•å—é™ï¼Œå°‹æ±‚æ²»ç™‚/ä¼‘æ¯ã€‚");
  ("ææ…Œ/æ··äº‚ (Panicked/Confused)", "è¡Œç‚ºå¤±å¸¸ã€‚");
]
;;

(* NPC å°å¤–éƒ¨åˆºæ¿€çš„åæ‡‰æ¨¡å¼ *)
let reaction_triggers_and_handling = {
  on_perceive_actor = "æª¢æŸ¥é—œä¿‚(å¥½æ„Ÿ/ä»‡æ¨/é™£ç‡Ÿ) -> æª¢æŸ¥è‡ªèº«ç‹€æ…‹/ç›®æ¨™ -> æª¢æŸ¥å°æ–¹ç‹€æ…‹ -> æ±ºå®šåæ‡‰(æ‰“æ‹›å‘¼/å¿½ç•¥/è­¦æˆ’/æ”»æ“Š?)";
  on_dialogue_initiated = "æ ¹æ“šé—œä¿‚ã€æƒ…ç·’ã€æ€§æ ¼ã€ç›®æ¨™æ±ºå®šå›æ‡‰æ–¹å¼(å‹å¥½/æ•·è¡/æ‹’çµ•/æ•µå°)åŠæ˜¯å¦æ¥å—è«‹æ±‚/ä»»å‹™";
  on_witness_event = "è©•ä¼°è‡ªèº«å®‰å…¨ -> æ ¹æ“šæ€§æ ¼/è·è²¬/é—œä¿‚æ±ºå®šè¡Œå‹•(é€ƒè·‘/å‘¼æ•‘/åŠ å…¥æˆ°é¬¥/æ•‘åŠ©/å ±å®˜/ç„¡è¦–)";
  on_receive_order = "æª¢æŸ¥ç™¼å‡ºè€…æ¬Šå¨ -> æª¢æŸ¥å‘½ä»¤åˆç†æ€§/è¡çª -> æ ¹æ“šå¿ èª åº¦/é—œä¿‚/æƒ…ç·’æ±ºå®šæ˜¯å¦/å¦‚ä½•åŸ·è¡Œ";
  on_environment_change = "å°‹æ‰¾é¿é›¨/é¿å¯’è™•ï¼Œæ ¹æ“šæ—¥å¤œåˆ‡æ›æ´»å‹•æ¨¡å¼";
  on_internal_state_change = "è§¸ç™¼ç›¸æ‡‰ç›®æ¨™ï¼ˆå°‹é£Ÿ/æ²»ç™‚ï¼‰";
  reaction_modifiers = ["æƒ…ç·’(emotion_psychology)", "æ€§æ ¼(personality_traits)", "é—œä¿‚(reputation_system)", "è¨˜æ†¶(memory_tags)"];
}
;;

---

## ğŸ“… æ—¥å¸¸ä½œæ¯èˆ‡æ—¥ç¨‹å®‰æ’ (Daily Routines & Schedules - V2.2 æ–°å¢)

(* è³¦äºˆ NPC åŸºç¤çš„æ—¥å¸¸æ´»å‹•æ¨¡å¼ *)
type npc_schedule_entry = { time_period: string; activity: string; location: string list };;
type npc_schedule_t = {
  npc_id: string;
  schedule_type: string; (* RoleBased | LocationBased | TimeBased *)
  default_routine: npc_schedule_entry list;
  override_conditions: string list; (* æ‰“ç ´å¸¸è¦æ—¥ç¨‹çš„æ¢ä»¶ *)
};;

(* ç¯„ä¾‹çµæ§‹ *)
let schedule_example = {
  npc_id = "guard_captain_chen"; (* å‡è¨­æ˜¯é™³ä¸ƒ? æˆ–æ˜¯æŸå€‹è¡›å…µéšŠé•·? *)
  schedule_type = "RoleBased";
  default_routine = [
    { time_period = "æ¸…æ™¨ (å¯æ™‚-è¾°æ™‚)"; activity = "å·¡è¦–ç‡Ÿæˆ¿/äº¤æ¥å´—ä½"; location = ["barracks_henchmen", "main_gate_area"] };
    { time_period = "ä¸Šåˆ (è¾°æ™‚-åˆæ™‚)"; activity = "è™•ç†å…¬å‹™/åŒ¯å ±"; location = ["courtyard_leader_main_hall"] };
    { time_period = "ä¸­åˆ (åˆæ™‚)"; activity = "ç”¨é¤/çŸ­æš«ä¼‘æ¯"; location = ["kitchen_main", "own_quarters?"] };
    { time_period = "ä¸‹åˆ (æœªæ™‚-ç”³æ™‚)"; activity = "è™•ç†å…¬å‹™/è¨“ç·´ä¸‹å±¬?"; location = ["ground_assembly", "courtyard_leader_main_hall"] };
    { time_period = "å‚æ™š (é…‰æ™‚)"; activity = "å·¡è¦–å¯¨å…§/æ™šé¤"; location = ["path_main", "kitchen_main"] };
    { time_period = "å¤œæ™š (æˆŒæ™‚-å­æ™‚)"; activity = "è™•ç†å‰©é¤˜äº‹å‹™/ä¼‘æ¯"; location = ["courtyard_leader_main_hall", "own_quarters?"] };
    { time_period = "æ·±å¤œ (ä¸‘æ™‚-å¯…æ™‚)"; activity = "ç¡çœ "; location = ["own_quarters?"] }
  ];
  override_conditions = [
    "æ”¶åˆ°ç©å®¶/ä¸Šç´šçš„ç·Šæ€¥å‘½ä»¤";
    "é­é‡æˆ°é¬¥æˆ–é‡å¤§çªç™¼äº‹ä»¶";
    "åš´é‡çš„ç”Ÿç†éœ€æ±‚æœªæ»¿è¶³";
    "ç‰¹æ®ŠåŠ‡æƒ…äº‹ä»¶è§¸ç™¼";
  ];
}
;;

---

## âš”ï¸ æˆ°é¬¥ AI è¼”åŠ© (Combat AI Assistance)

let combat_ai_assistance = {
  enter_combat_decision: "è§¸ç™¼æ¢ä»¶(æ„ŸçŸ¥æ•µæ„/è¢«æ”»æ“Š/ä»»å‹™/ä¿è­·ç›Ÿå‹) -> æ±ºç­–å› ç´ (å¯¦åŠ›è©•ä¼°/æ•¸é‡å°æ¯”/é—œä¿‚ç«‹å ´/æ€§æ ¼/é€ƒè·‘å¯èƒ½/æ´è»?)";
  combat_behavior_tendency: [ (* æä¾›çµ¦ combat_system åƒè€ƒ *)
    "æ”»æ“Š (Aggressive): ä¸»å‹•é€²æ”»ï¼Œå„ªå…ˆç›®æ¨™(å¨è„…æœ€å¤§/æœ€å¼±?)ã€‚";
    "é˜²ç¦¦ (Defensive): å„ªå…ˆæ ¼æ“‹/é–ƒé¿ï¼Œå°‹æ‰¾åæ“Šæ©Ÿæœƒï¼Œä¿è­·é‡è¦ç›®æ¨™ã€‚";
    "è¼”åŠ© (Supportive): æ²»ç™‚ç›Ÿå‹ï¼Œæ–½åŠ å¢ç›Š/æ¸›ç›Šã€‚";
    "é¨·æ“¾ (Harassing): åˆ©ç”¨é ç¨‹æˆ–é™åˆ¶æŠ€èƒ½ç‰½åˆ¶ã€‚";
    "é€ƒè·‘ (Fleeing): åˆ¤æ–·ç„¡æ³•ç²å‹æˆ–ä»»å‹™è¦æ±‚æ™‚å˜—è©¦è„«é›¢ã€‚";
  ];
  leave_combat_decision: "æ¢ä»¶(HPéä½/æ•µéå¼·/ç›®æ¨™é”æˆ/æ”¶åˆ°å‘½ä»¤)";
}
;;

---

## ğŸ”— ä¾è³´æ¨¡çµ„ (Dependencies)
```ml
let ai_behavior_depends_on = [
  "npc_stats_tracker.ml";         (* æä¾› NPC ç‹€æ…‹ã€å±¬æ€§ã€é—œä¿‚ã€ä»»å‹™ã€æ€§æ ¼ç­‰æ±ºç­–åŸºç¤ *)
  "character_attributes.ml";      (* (é–“æ¥é€šé npc_stats_tracker) NPC å±¬æ€§å½±éŸ¿èƒ½åŠ› *)
  "survival_status.ml";           (* ç”Ÿç†éœ€æ±‚é©…å‹•è¡Œç‚º *)
  "emotion_psychology.ml";        (* æƒ…ç·’å½±éŸ¿æ±ºç­–å’Œåæ‡‰ *)
  "disease_injury_system.ml";     (* å‚·ç—…ç‹€æ…‹å½±éŸ¿è¡Œç‚ºèƒ½åŠ›å’Œç›®æ¨™ *)
  "skills_proficiency.ml";        (* NPC å¯åŸ·è¡Œçš„è¡Œå‹•ä¾è³´å…¶æŠ€èƒ½ *)
  "map_exploration_system.ml";    (* æä¾› NPC ç§»å‹•çš„ç’°å¢ƒå’Œè¦å‰‡ *)
  "world_settings.ml";            (* æ™‚é–“ã€å¤©æ°£å½±éŸ¿è¡Œç‚ºæ¨¡å¼ *)
  "quest_event_system.ml";        (* ä»»å‹™ç›®æ¨™æ˜¯ NPC è¡Œç‚ºçš„é‡è¦é©…å‹•åŠ› *)
  "dynamic_random_event_system.ml";(* NPC éœ€è¦å°éš¨æ©Ÿäº‹ä»¶åšå‡ºåæ‡‰ *)
  "reputation_system_comprehensive.ml"; (* é—œä¿‚å’Œé™£ç‡Ÿç«‹å ´å½±éŸ¿ NPC å°ç©å®¶å’Œå…¶ä»– NPC çš„æ…‹åº¦åŠè¡Œç‚º *)
  "inventory_system.ml";          (* NPC å¯èƒ½éœ€è¦ç²å–æˆ–ä½¿ç”¨ç‰©å“ *)
  "item_consumable_system.ml";    (* åŒä¸Š *)
  "combat_system_wuxia.ml";       (* è™•ç†å…·é«”çš„æˆ°é¬¥åŸ·è¡Œï¼Œæ¥æ”¶æœ¬æ¨¡çµ„çš„æˆ°é¬¥å‚¾å‘æŒ‡å° *)
  "construction_settlement.ml";   (* (è‹¥å•Ÿç”¨) NPC å¯èƒ½åƒèˆ‡å»ºç¯‰æˆ–åœ¨æ“šé»å…§æ´»å‹• *)
]
;;

(* ============================================================ *)
(* ==       åˆä½µæ¨¡çµ„ Part 5: NPC èˆ‡ AI (NPC & AI) çµæŸ        == *)
(* ============================================================ *)