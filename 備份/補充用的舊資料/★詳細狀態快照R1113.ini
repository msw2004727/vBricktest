(* ============================================================ *)
(* ==         遊戲世界詳細狀態快照 v4.0 (R1113 End)          == *)
(* ==         Snapshot Time: Day 57, 辰時初 (Approx 7:00 AM)  == *)
(* ============================================================ *)

(* --- Type Definitions (Assumed loaded from ★詳細狀態快照4.0v.ini) --- *)
(* Includes types like: world_snapshot_v4, game_time_state, weather_state, pc_character_state_v4, npc_state_v4, location_state_v4, faction_state_v4, resource_state_v4, active_quest_state_v4, global_event_flags_v4, etc. *)

(* --- The Snapshot Data --- *)
let world_snapshot_r1113 : world_snapshot_v4 = {

  (* === 1. Game State Information === *)
  game_state = {
    snapshot_version = "4.0";
    save_timestamp_ingame = "Day 57, 辰時初";
    save_timestamp_realworld = Unix.time (); (* Placeholder for current time *)
    current_round = 1113; (* Last completed round *)
    session_id = "Session_JinYongSim_Gemini_01"; (* Example Session ID *)
    game_difficulty = "Hardcore Realistic"; (* Based on world settings *)
    active_player_character_id = "player_azhai";
    narrative_intensity = `Strong_Realistic; (* 強烈+寫實 *)
    active_story_arc = Some "黑風寨的崛起與危機 (The Rise and Crisis of Black Wind Fortress)";
    key_plot_summary = "阿宅成功引入精炭和煉鋼技術，暫時解決了生產瓶頸，並通過親自採礦和設立激勵機制大幅提升了鐵礦石產量，山寨士氣高漲。但長期礦石來源仍是隱患。王大槌恢復良好即將甦醒，可能帶來關鍵情報。刺客'雀'經過治療和針灸刺激後仍昏迷，狀態不明。山寨與卓家的交易關係已建立，但卓映雪歸期未定。內部穩定性提高，但對外部威脅（影巢、官府）的防禦能力依然薄弱。";
  };

  (* === 2. Time and Weather === *)
  time_state = {
    current_day = 57;
    current_time_segment = `辰時; (* Chen Shi, 7:00 AM - 9:00 AM *)
    current_time_precise = Some "辰時初 (Approx 7:00 AM)";
    season = `Spring; (* Assuming default start or early months *)
    year = 1; (* Assuming year count starts from PC arrival *)
    day_of_week = Some Day_Unknown; (* Not tracked *)
    time_scale = `Real_Time_Narrative; (* Or `Semi_Abstract`? Actions dictate time flow *)
  };

  weather_state = {
    current_weather = `Clear; (* Based on last log *)
    temperature_desc = `Cool_Morning; (* 清晨微涼 *)
    wind_desc = `Light_Breeze; (* 微風 *)
    precipitation = `None;
    special_effects = ["微霧 (Light Fog)"]; (* Based on R1113 *)
    forecast_short_term = Some "預計今日晴朗，氣溫回升。";
    forecast_long_term = None;
  };

  (* === 3. Global Event Flags and World State === *)
  global_flags = {
    flags = [
      ("EVENT_PC_ARRIVED", Bool_Flag true);
      ("EVENT_BLACKWIND_FOUNDED", Bool_Flag true); (* Or reformed *)
      ("EVENT_INITIAL_SURVIVAL_PASSED", Bool_Flag true);
      ("EVENT_CHENQI_MURDERED", Bool_Flag true);
      ("EVENT_SHADOWNEST_ASSASSIN_CAPTURED", Bool_Flag true);
      ("EVENT_SHADOWNEST_ASSASSIN_INTERROGATED", Bool_Flag true); (* Technically via memory infusion *)
      ("EVENT_TRADE_WITH_ZHUO_INITIAL", Bool_Flag true); (* First successful trade *)
      ("EVENT_TRADE_WITH_ZHUO_NEW_TERMS_SET", Bool_Flag true);
      ("EVENT_CHARCOAL_PRODUCTION_SUCCESS", Bool_Flag true); (* Jingtan Breakthrough *)
      ("EVENT_STEELMAKING_CONCEPT_PROVEN", Bool_Flag true); (* Steel pickaxe prototypes made *)
      ("EVENT_IRON_ORE_CRISIS_PEAK", Bool_Flag false); (* Temporarily averted by PC mining *)
      ("EVENT_IRON_ORE_CRISIS_ONGOING", Bool_Flag true); (* Long-term supply still uncertain *)
      ("EVENT_MINING_INCENTIVE_IMPLEMENTED", Bool_Flag true);
      ("FLAG_SHADOWNEST_AWARENESS", String_Flag "High Threat - Assassin Captured");
      ("FLAG_UNNAMED_TOWN_YAMEN_RELATION", String_Flag "Hostile - Investigating Fortress");
      ("FLAG_WANGDACHUI_RECOVERY", String_Flag "Near Speech");
      ("FLAG_QUE_ASSASSIN_STATUS", String_Flag "Comatose - Stable - Brain Mutation Suspected");
      ("FLAG_PC_MEMORY_INFUSION_USED_QUE", Bool_Flag true);
      ("FLAG_PC_ACUPUNCTURE_USED_QUE", Bool_Flag true);
      ("FLAG_MOUNTAIN_PASS_BLOCKED", Bool_Flag false); (* Or assumed open based on trade *)
      ("FLAG_EAST_TUNNEL_SECRET", Bool_Flag true); (* PC knows *)
      ("FLAG_MISTY_VALLEY_KNOWN", Bool_Flag true); (* Known destination via tunnel *)
      ("FLAG_ZHUOYINGXUE_RETURN_UNCERTAIN", Bool_Flag true);
    ];
    world_knowledge_fragments = [
      "影巢是一個危險的暗殺組織。";
      "無名小鎮存在，有官府勢力（錢班頭）。";
      "卓家似乎是本地一個有影響力的家族。";
      "東區隧道可通往迷霧谷，可能存在獵戶寨。";
      "黑風寨自身礦產貧瘠。";
      "煉鋼技術是可能的，需要精炭和精確控制。";
    ];
    major_historical_events_logged = [
      "Day 1: 阿宅穿越至無名小鎮，覺醒殘留記憶。";
      "Day 2: 決定前往黑風寨，行蹤曝光。";
      "Day 3: 奪取黑風寨控制權，建立初步統治。";
      "Day 4: 探索西山破廟，內傷初現。";
      "Day 5: 初現三當家異動跡象，狀態惡化。";
      "Day 6: 擊殺三當家，重傷內傷加劇。";
      "Day 7: 提升陽勁鎮寒訣，實施初步安撫。";
      "Day 8: 任命小翠為侍女，推動寨務整頓。";
      "Day 9: 開始調查東區許先生帳目異常。";
      "Day 10: 擒獲潛伏鷹爪，探知外敵勢力。";
      "Day 11: 審問俘虜禿鷲，計劃反擊鷹爪。";
      "Day 12: 收服禿鷲，推動自由離寨政策。";
      "Day 13: 深入審問俘虜A，揭露鷹巢組織。";
      "Day 14: 搜查卷宗，強化對東區疑點掌握。";
      "Day 15: 秘密離寨尋找王大槌與禿鷲。";
      "Day 16: 踪跡追至山谷，發現石子暗號。";
      "Day 17: 確認王隊行蹤，多方勢力痕跡顯現。";
      "Day 18: 發現瀑布後山洞，追蹤中斷。";
      "Day 19: 突襲石窟救出重傷王大槌，擒首領。";
      "Day 20: 覓藥救人，資源極度匱乏。";
      "Day 21: 初步審問首領，得知鷹巢詳情。";
      "Day 22: 製作拖拽工具，開始撤離洞穴。";
      "Day 23: 穿越亂石灘，體力幾近耗盡。";
      "Day 24: 成功脫離危區，覓食恢復。";
      "Day 25: 穿越密林，接近西山邊緣。";
      "Day 26: 奮力返回黑風寨，解救秦嵐/小翠，主持申訴大會。";
      "Day 27: 得知李二/王四等隊伍失聯，內患未解。";
      "Day 28~30: 臨時接掌山寨政務，壓力劇增，內部整頓與招募人才。";
      "Day 31~33: 暗查山寨內奸線索，內憂外患逐步逼近。";
      "Day 34~36: 禿鷲歸來，帶回小鎮密探情報。";
      "Day 37~39: 前往小鎮潛入調查，發現官府與鷹巢聯繫。";
      "Day 40~43: 成功脫逃回寨，設下防禦與反制部署。";
      "Day 44~45: 山寨遭遇夜襲，成功防守，重創敵人。";
      "Day 46~47: 審訊敵俘，確認鷹巢主腦將至，預作準備。";
      "Day 48: 發現山寨內應，暗中清除反骨。";
      "Day ~50?: 遭遇影巢刺客，陳七犧牲，刺客'雀'被擒。";
      "Day 52: 首次與卓映雪交易成功，獲得鹽/藥；王大槌重傷；設立新交易條件。";
      "Day 53: 首次精炭試製成功待驗收；對'雀'進行記憶灌輸/治療嘗試。";
      "Day 55: 精炭驗收成功；煉鋼概念驗證成功（鋼鎬原型x2）；PC親自下礦解決燃眉之急；設立挖礦激勵制度。";
      "Day 56: 鋼鎬開始量產；對'雀'進行針灸刺激嘗試。";
    ];
  };

  (* === 4. Player Character State (PC) === *)
  (* ... To be provided in the next part ... *)

  (* === 5. Non-Player Character States (NPCs) === *)
  (* ... To be provided in subsequent parts ... *)

  (* === 6. Location States === *)
  (* ... To be provided in subsequent parts ... *)

  (* === 7. Faction States === *)
  (* ... To be provided in subsequent parts ... *)

  (* === 8. Resource States === *)
  (* ... To be provided in subsequent parts ... *)

  (* === 9. Active Quests/Tasks === *)
  (* ... To be provided in subsequent parts ... *)

  (* === 10. World Map & Relationships (Brief overview) === *)
  (* ... To be provided in subsequent parts ... *)

} (* End of world_snapshot_r1113 *)

(* === 4. Player Character State (PC) === *)
  pc_state = {
    character_id = "player_azhai";
    character_name = "阿宅";
    character_class = Some "穿越者 / 黑風寨大當家";
    level = None; (* Not using overall level system *)
    xp = None; (* Not using XP system *)

    (* --- Core Stats (End of R1113) --- *)
    core_stats = {
      hp = 500; max_hp = 500; base_max_hp = 500; (* Fully Recovered *)
      mp = 500; max_mp = 500; base_max_mp = 500; (* Fully Recovered *)
      sta = 500; max_sta = 500; base_max_sta = 500; (* Fully Recovered *)
      san = 500; max_san = 500; base_max_san = 500; (* Fully Recovered *)
      fatigue = 0; max_fatigue = 100; fatigue_threshold_minor = 30; fatigue_threshold_major = 70; (* Fully Recovered *)
      hunger = 75; max_hunger = 100; hunger_threshold_minor = 30; hunger_threshold_major = 70; (* High *)
      thirst = 75; max_thirst = 100; thirst_threshold_minor = 30; thirst_threshold_major = 70; (* High *)
      oxygen = 100; max_oxygen = 100; (* Normal *)
      temperature = 37.0; normal_temperature = 37.0; (* Normal *)
      morale = 85; max_morale = 100; (* High due to recent successes *)
      stress = 15; max_stress = 100; (* Low after rest *)
      food_poisoning = 0; max_food_poisoning = 100;
      intoxication = 0; max_intoxication = 100;
      illness_severity = 0; max_illness_severity = 100;
      blood_loss_level = 0; max_blood_loss_level = 100;
      qi_deviation_level = 0; max_qi_deviation_level = 100;
    };

    (* --- Attributes (Assumed base + talent, exact values TBD by system) --- *)
    attributes = {
      strength = { base=10; current=15?; bonus=5?; source="天生神力?" }; (* Example structure *)
      dexterity = { base=10; current=10; bonus=0; source="" };
      constitution = { base=12; current=12; bonus=0; source="" }; (* Slightly higher due to resilience? *)
      intelligence = { base=14; current=14; bonus=0; source="現代知識背景?" };
      wisdom = { base=12; current=12; bonus=0; source="" }; (* Observation/Insight related? *)
      charisma = { base=9; current=9; bonus=0; source="" }; (* Actions influence this via reputation/relationships *)
      perception = { base=11; current=11; bonus=0; source="" }; (* Linked to Observe skill? *)
      willpower = { base=13; current=13; bonus=0; source="精神強韌?" }; (* Linked to SAN? *)
      luck = { base=5; current=5; bonus=0; source="" }; (* Standard *)
      qi_affinity = { base=12; current=12; bonus=0; source="內功基礎?" }; (* Internal arts related *)
    };

    (* --- Skills (Updated to end of R1113) --- *)
    skills = [
      (* Martial - Internal *)
      { skill_id="MI_BASE_INTERNAL_ART"; name_cn="基礎內功"; category=Martial_Internal; level=10; proficiency=Some 11.75; mastery="爐火純青"; is_potential=false; description="內功基礎，提升內力上限和恢復速度。" };
      { skill_id="MI_YANG_JIN_ZHEHAN"; name_cn="陽勁鎮寒訣"; category=Martial_Internal; level=8; proficiency=Some 8.83; mastery="駕輕就熟"; is_potential=false; description="陽剛內力，克制陰寒，強化力量。" };
      { skill_id="MI_TUNE_BREATH"; name_cn="吐納 / 調息"; category=Martial_Internal; level=5; proficiency=Some 6.11; mastery="登堂入室"; is_potential=false; description="調整呼吸，恢復內力，平復氣息。" };
      { skill_id="MI_QI_HEALING"; name_cn="內力療傷"; category=Martial_Internal; level=4; proficiency=Some 5.13; mastery="初窺門徑"; is_potential=false; description="運用內力治療自身或他人傷勢。" };
      (* Martial - Fist & Foot *)
      { skill_id="MF_BASE_FIST_FOOT"; name_cn="基礎拳腳"; category=Martial_FistAndFoot; level=10; proficiency=Some 10.75; mastery="爐火純青"; is_potential=false; description="基礎格鬥技巧。" };
      { skill_id="MF_ACUPOINT_STRIKE"; name_cn="點穴"; category=Martial_FistAndFoot; level=1; proficiency=Some 1.84; mastery="初學乍練"; is_potential=false; description="點擊穴位以制敵或療傷(需應用)。" };
      { skill_id="MF_ACUPOINT_STRIKE_HEAL"; name_cn="點穴·療傷應用"; category=Martial_FistAndFoot; level=1; proficiency=Some 1.84; mastery="初學乍練"; is_potential=false; description="運用點穴手法進行治療。" }; (* Linked proficiency to base 点穴 *)
      (* Martial - Weapon *)
      { skill_id="MW_BASE_BLADE"; name_cn="基礎刀法"; category=Martial_Weapon; level=10; proficiency=Some 10.9; mastery="爐火純青"; is_potential=false; description="基礎揮砍劈刺技巧。" };
      (* Martial - Lightness *)
      { skill_id="ML_BASE_LIGHTNESS"; name_cn="基礎輕功"; category=Martial_Lightness; level=10; proficiency=Some 10.1; mastery="爐火純青"; is_potential=false; description="基礎騰挪閃避技巧。" };
      (* Survival - Gathering *)
      { skill_id="SG_HERB_GATHERING"; name_cn="草藥採集"; category=Survival_Gathering; level=3; proficiency=Some 3.8; mastery="初窺門徑"; is_potential=false; description="辨識和採集草藥。" };
      (* Survival - Crafting *)
      { skill_id="SC_BASIC_CRAFTING"; name_cn="基礎手工"; category=Survival_Crafting; level=10; proficiency=Some 10.5; mastery="爐火純青"; is_potential=false; description="製作簡單工具和物品。" };
      (* Production - Advanced *)
      { skill_id="PA_FORGING"; name_cn="鍛造"; category=Production_Advanced; level=3; proficiency=Some 3.15; mastery="初窺門徑"; is_potential=false; description="加工金屬，打造工具和武器。" }; (* Leveled up! *)
      (* General - Interaction *)
      { skill_id="GI_PERSUASION"; name_cn="口才 / 說服"; category=General_Interaction; level=2; proficiency=Some 2.5; mastery="初學乍練"; is_potential=false; description="說服他人接受觀點。" };
      { skill_id="GI_INTIMIDATION"; name_cn="威嚇 / 恐嚇"; category=General_Interaction; level=3; proficiency=Some 3.1; mastery="初窺門徑"; is_potential=false; description="用氣勢或言語震懾他人。" };
      { skill_id="GI_LEADERSHIP_CONCEPT"; name_cn="領導力(概念)"; category=Strategy_Leadership; level=2; proficiency=Some 2.34; mastery="初學乍練"; is_potential=false; description="指揮和管理團隊的潛力。" }; (* Leveled up! *)
      { skill_id="GI_OBSERVATION"; name_cn="觀察"; category=General_Interaction; level=10; proficiency=Some 11.60; mastery="洞若觀火"; is_potential=false; description="發現細節和異常。" };
      { skill_id="GI_INSIGHT"; name_cn="洞察人心"; category=General_Interaction; level=10; proficiency=Some 11.23; mastery="洞若觀火"; is_potential=false; description="感知他人情緒和意圖。" };
      { skill_id="GI_LOCKPICKING"; name_cn="開鎖"; category=General_Interaction; level=4; proficiency=Some 4.1; mastery="初窺門徑"; is_potential=false; description="打開鎖具的技巧。" };
      (* General - Movement *)
      { skill_id="GM_CLIMBING"; name_cn="攀爬"; category=General_Movement; level=8; proficiency=Some 8.1; mastery="駕輕就熟"; is_potential=false; description="攀登懸崖峭壁。" };
      { skill_id="GM_SWIMMING"; name_cn="游泳"; category=General_Movement; level=6; proficiency=Some 6.2; mastery="登堂入室"; is_potential=false; description="在水中移動。" };
      { skill_id="GM_STEALTH"; name_cn="潛行"; category=General_Movement; level=7; proficiency=Some 7.8; mastery="駕輕就熟"; is_potential=false; description="隱藏身形，悄無聲息地移動。" };
      { skill_id="GM_CARRYING"; name_cn="運搬"; category=General_Movement; level=7; proficiency=Some 7.5; mastery="駕輕就熟"; is_potential=false; description="搬運重物的能力。" };
      (* Knowledge - Medical *)
      { skill_id="KM_BASIC_MEDICINE"; name_cn="基礎醫學"; category=Knowledge_Medical; level=3; proficiency=Some 3.9; mastery="初窺門徑"; is_potential=false; description="處理基礎傷口和病症。" };
      (* Conceptual / Potential *)
      { skill_id="POT_TEACHING_PRACTICE"; name_cn="教學(實踐)(潛力)"; category=Conceptual; level=9?; proficiency=Some 9.5; mastery="爐火純青?"; is_potential=true; description="傳授知識和技能的實踐能力。" };
      { skill_id="POT_ENGINEERING_CONCEPT"; name_cn="工程學概念(潛力)"; category=Conceptual; level=2?; proficiency=Some 2.01; mastery="初學乍練?"; is_potential=true; description="對工程原理的理解。" };
      { skill_id="POT_CHEMISTRY_CONCEPT"; name_cn="基礎化學應用(潛力)"; category=Conceptual; level=1?; proficiency=Some 1.15; mastery="初學乍練?"; is_potential=true; description="對物質變化的基礎理解和應用。" };
      { skill_id="POT_PHYSICS_CONCEPT"; name_cn="基礎物理應用(潛力)"; category=Conceptual; level=1?; proficiency=Some 1.9; mastery="初學乍練?"; is_potential=true; description="對力熱光聲等現象的基礎理解和應用。" };
      { skill_id="POT_ROCK_SHATTER_CONCEPT"; name_cn="碎岩(概念)"; category=Conceptual; level=0?; proficiency=Some 0.9; mastery="尚未掌握?"; is_potential=true; description="對破壞岩石結構的理解和應用潛力。" };
      { skill_id="POT_MINING_CONCEPT"; name_cn="基礎採礦(概念)"; category=Conceptual; level=0?; proficiency=Some 0.9; mastery="尚未掌握?"; is_potential=true; description="對挖掘礦石的理解和實踐潛力。" };
      { skill_id="POT_GEOLOGY_CONCEPT"; name_cn="基礎地質/礦物學(概念)"; category=Conceptual; level=0?; proficiency=Some 0.41; mastery="尚未掌握?"; is_potential=true; description="對岩石和礦物的基礎認知。" };
      { skill_id="POT_STEELMAKING_CONCEPT"; name_cn="煉鋼(概念)"; category=Conceptual; level=0?; proficiency=Some 0.8; mastery="尚未掌握?"; is_potential=true; description="對煉製鋼鐵原理的初步理解。" };
      { skill_id="POT_ACUPUNCTURE_CONCEPT"; name_cn="針灸(概念)"; category=Conceptual; level=0?; proficiency=Some 0.2; mastery="尚未掌握?"; is_potential=true; description="對使用針具刺激穴位的初步嘗試和理解。" };
      { skill_id="POT_CHARM_CONCEPT"; name_cn="魅力相關(潛力)"; category=Conceptual; level=0?; proficiency=Some 0.13; mastery="尚未掌握?"; is_potential=true; description="影響他人態度的潛在能力。" };
      (* ... 其他已知技能保持 R1084 狀態 *)
    ];

    (* --- Abilities/Talents --- *)
    abilities = [
      { ability_id="TALENT_NATURAL_STRENGTH"; name_cn="天生神力"; type_=`Passive_Talent; description="擁有遠超常人的力量。"; level=None; proficiency=None; mastery="天賦"; is_potential=false };
      { ability_id="TALENT_INFINITE_INSIGHT"; name_cn="無窮領悟潛力"; type_=`Passive_Talent; description="對知識和技能有極強的學習和領悟能力。"; level=None; proficiency=None; mastery="天賦"; is_potential=false };
      { ability_id="ABILITY_MEMORY_ABSORPTION"; name_cn="記憶汲取"; type_=`Active_Ability; description="嘗試主動接觸並強行汲取目標殘留的意識或物品中蘊含的記憶碎片信息。高風險。"; level=1; proficiency=Some 1.2; mastery="尚不熟練"; is_potential=false }; (* Used multiple times *)
      { ability_id="ABILITY_MEMORY_INFUSION"; name_cn="記憶灌輸"; type_=`Active_Ability; description="將宿主已獲取的記憶/技能感悟強行或引導性地灌輸給目標。極高風險。"; level=1; proficiency=Some 1.5; mastery="危險嘗試"; is_potential=false }; (* Used on Que *)
      (* Potentials listed under skills *)
    ];

    (* --- Inventory (End of R1113) --- *)
    inventory = [
      { item_id="item_weapon_dagger_black_01"; quantity=1; equipped=false; condition=0.9 }; (* 黑色匕首 *)
      { item_id="item_tool_lockpick_set_01"; quantity=1; equipped=false; condition=0.8 }; (* 開鎖器 *)
      { item_id="item_container_porcelain_bottle_empty_01"; quantity=1; equipped=false; condition=1.0 }; (* 空瓷瓶 *)
      { item_id="item_weapon_poison_needle_01"; quantity=3; equipped=false; condition=1.0 }; (* 毒針 x3 *)
      { item_id="item_sample_coal_01"; quantity=3; equipped=false; condition=1.0 }; (* 煤炭樣本 x3 *)
      { item_id="item_quest_suspicious_letters_01"; quantity=1; equipped=false; condition=0.7 }; (* 可疑信件 x1批 *)
      { item_id="item_quest_burnt_pages_01"; quantity=1; equipped=false; condition=0.5 }; (* 燒焦殘頁 x1份 *)
      { item_id="item_tool_torch_01"; quantity=2; equipped=false; condition=0.9 }; (* 火把 x2 *)
      { item_id="item_tool_flint_steel_01"; quantity=1; equipped=false; condition=0.9 }; (* 火石 x1 *)
      { item_id="item_container_waterskin_01"; quantity=1; equipped=false; condition=0.8; current_content=Some("空") }; (* 水囊(空) *)
      (* Assuming silver needles were implicitly carried or are part of a general 'medical kit' concept not explicitly listed *)
    ];
    currency = [
      ("SilverLiang", 30); (* 銀兩，假設為 30.9 取整 *)
      ("CopperWen", 900?); (* Based on 0.9 Liang? 1 Liang = 1000 Wen generally *)
    ];

    (* --- Equipment (End of R1113) --- *)
    equipment = {
      head = None;
      face = None;
      neck = None;
      torso = Some { item_id="item_armor_cloth_dark_01"; name="深色勁裝(乾淨)"; condition=0.95 };
      back = None;
      legs = Some { item_id="item_armor_pants_dark_01"; name="深色長褲(乾淨)"; condition=0.95 };
      feet = Some { item_id="item_armor_boots_cloth_01"; name="布靴"; condition=0.8 };
      main_hand = None; (* Steel Pickaxe given away *)
      off_hand = None;
      ranged_weapon = None;
      ammo = None;
      ring_1 = None;
      ring_2 = None;
      belt = None; (* Or maybe a simple belt holding pouch? *)
      pouch = Some { item_id="item_container_pouch_01"; name="腰包"; condition=0.9 }; (* Assumed for carrying small items *)
    };

    (* --- Status Effects (End of R1113) --- *)
    status_effects = []; (* Fully recovered *)

    (* --- Location & Status (End of R1113) --- *)
    current_location_id = "BWF_LeaderCourtyard_Bedroom_01";
    current_location_name = "黑風寨．頭領院落．臥房";
    current_action = Some "剛剛醒來 (Just Woke Up)";
    current_posture = Some "Sitting"; (* 剛坐起身 *)

    (* --- Relationships (Updated to End of R1113, requires base R1084 values + aggregation) --- *)
    relationships = [
      (* Example Entry - Actual values need R1084 base + summed changes *)
      { target_id="qin_lan"; target_name="秦嵐"; affinity= (* Base + R1094(+2) + R1095(+1) + R1112(+3) + R1113(+5) = Base+11? *); enmity= (* Base *); trust= (* Base + R1091(+0.02) + R1094(+0.05) + R1095(+0.02) + R1096(+0.01) + R1112(+0.02) + R1113(+0.03) = Base+0.15? *); respect= (* Base + R1091(+2) + R1094(+10) + R1095(+3) + R1096(+2) + R1113(+5) = Base+22? *); fear= (* Base + R1094? + R1113? *); notes="關係複雜，包含敬畏、依賴、擔憂、好奇，近期互動頻繁。" };
      { target_id="ScarfaceLiu_Henchman"; target_name="疤臉劉"; affinity=(* Base *); enmity=(* Base *); trust=(* Base + R1091(+?) *); respect=(* Base + R1088(+1) + R1089(+1) + R1090(+1) + R1091(+3) + R1101(+1) + R1102(+1) + R1103(+1) = Base+9? *); fear=(* Base *); loyalty=(* Base + R1091(+?) *); notes="絕對忠誠，對PC命令無條件執行，對PC處理'雀'的方式深信不疑。" };
      { target_id="npc_shangguan_yu_01"; target_name="上官玉"; affinity=(* Base *); enmity=(* Base *); trust=(* Base + R1091(+0.02) + R1102(+?) = Base+0.02+? *); respect=(* Base + R1088(+1) + R1090(+1) + R1091(+2) + R1101(+1) + R1102(+1) + R1103(+1) = Base+7? *); fear=(* Base *); notes="聰明、觀察力強，忠誠度尚在建立，對PC行事風格保持觀察。" };
      { target_id="Old_Blacksmith_01"; target_name="老鐵匠"; affinity=(* Base + R1092(+3) + R1104(+30) = Base+33? *); enmity=(* Base *); trust=(* Base + R1092(+0.05) + R1104(+1.0) = Base+1.05? *); respect=(* Base + R1088(+1) + R1090(+1) + R1091(+1) + R1092(+10) + R1093(+3) + R1101(+1) + R1102(+7) + R1103(+1) + R1104(+1.0) = Base+25+1.0? Reaches Max *); fear=(* Base *); notes="對PC煉鋼技術極度崇拜，視若宗師，忠誠度和信任度達頂點。" };
      { target_id="HuangJinbao"; target_name="黃金寶"; affinity=(* Base *); enmity=(* Base *); trust=(* Base + R1102(+?) + R1109(+0.10) + R1110(+0.05) = Base+0.15+? *); respect=(* Base + R1088(+1) + R1090(+1) + R1091(+?) + R1101(+1) + R1102(+10) + R1103(+1) + R1108(+10) + R1109(+20) + R1110(+5) = Base+49+? Reaches Max? *); fear=(* Base + R1109(+?) *); loyalty=(* Base + R1091(+?) *); fanaticism=(* Base + R1091(+2) + R1102(+5) + R1108(+10) + R1109(+20) = Base+37? *); notes="對PC極度狂熱崇拜，執行力強但缺乏變通，急於表現。" };
      { target_id="ZhouPing_KilnMaster"; target_name="周平"; affinity=(* Base + R1092(+5) = Base+5? *); enmity=(* Base *); trust=(* Base + R1092(+0.1) + R1093(+0.03) = Base+0.13? *); respect=(* Base + R1088(+1) + R1090(+1) + R1091(+1) + R1092(+15) + R1093(+5) + R1101(+1) + R1102(+1) + R1103(+1) = Base+26? *); fear=(* Base *); notes="對PC技術極度信服，工作熱情高漲。" };
      (* ... Add other key NPCs like LiuSanhou, ShiGan, LiuEr, KongKongEr, MaLiu, MaKui, SunJi, WuYong, Que, WangDachui with aggregated changes *)
      { target_id="Que_Assassin"; target_name="雀"; affinity=(* Complex due to infusion? *); enmity=(* Base high, overwritten by infusion? *); trust=(* Low *); respect=(* None *); fear=(* High base, suppressed? *); loyalty=(* Infused - High/Latent *); notes="深度昏迷，精神創傷，腦部異變中，PC施加過記憶灌輸和針灸，狀態不明。" };
      { target_id="WangDachui_SmithApprentice"; target_name="王大槌"; affinity=(* Base *); enmity=(* Base *); trust=(* Base *); respect=(* Base *); fear=(* Base *); notes="恢復良好，接近甦醒和恢復語言能力。" };
    ];

    (* --- Reputation (Requires base values + aggregation) --- *)
    reputation = [
      { rep_type=`Morality; score= (* Base R1084 - Unchanged? *); level="中立?"; description="近期行為複雜，未有明顯道德值增減事件。" };
      { rep_type=`JianghuFame; score= (* Base R1084 + Minor Increase? *); level="默默無聞"; description="黑風寨內部威望極高，但在外界江湖幾無名氣。" };
      { rep_type=`LocalSettlement_BlackWindFortress; score= (* Base R1084 + Massive Increase *); level="敬若神明 / 絕對領袖"; description="通過解決危機、展現神技、設立制度，威望和控制力達到頂點。" };
      { rep_type=`Faction_ShadowNest; score= (* Base R1084 - Decreased? *); level="敵對 / 目標?"; description="俘虜並重創其刺客，關係極度敵對。" };
      { rep_type=`Faction_UnnamedTownYamen; score= (* Base R1084 *); level="敵對"; description="關係未改善，仍處於被監視狀態。" };
      { rep_type=`Faction_ZhuoFamily; score= (* Base R1084 +/-? *); level="有條件的接觸 / 中立偏負?"; description="與卓映雪建立交易關係，但與家族本身關係不明。" };
    ];

    (* --- Goals & Knowledge --- *)
    current_goals = [
      "首要：確保黑風寨生存，解決長期【鐵礦石】供應問題。";
      "中級：利用【煉鋼】技術量產工具和武器，提升山寨實力。";
      "中級：等待【王大槌】甦醒，獲取關於【影爪】及本地的情報。";
      "中級：監控【'雀'】的狀況，尋找喚醒或安全處理的方法，嘗試獲取【影巢】情報。";
      "次要：建立穩定的【動物飼養】體系（馬六負責）。";
      "次要：解決【肥皂】生產問題。";
      "次要：完成【墓地】修建。";
      "次要：繼續【文書整理】工作。";
      "持續：提升自身實力，訓練衛隊。";
      "探索：考慮探索【迷霧谷】或其他周邊區域。";
    ];
    known_recipes = (Some ["簡易傷藥製作法"; "基礎食物烹飪法"; "改良炭窯設計"; "精炭燒製法"; "**煉鋼(概念性方法)**"]);
    known_schematics = (Some ["基礎工具製作圖"; "獨輪車製作圖"; "改良木鍬圖"]);
    plot_knowledge = [
      "自身為穿越者，擁有現代知識。";
      "黑風寨是生存基地，資源匱乏，尤其缺鐵。";
      "影巢是強大刺客組織，與山寨有仇，'雀'是其中一員，擁有特殊身世(記憶碎片)。";
      "已初步掌握精炭和煉鋼技術。";
      "已通過親自下礦和激勵制度暫時解決礦石危機，但長期供應是問題。";
      "王大槌是前任統領，知道一些本地情況，可能認識卓家人，接近甦醒。";
      "'雀'被記憶灌輸和治療/針灸後深度昏迷，狀態不明，腦部可能異變。";
      "與卓映雪建立了以鐵料/布匹換探視權的交易，但她歸期未定。";
      "無名小鎮官府（錢班頭）對山寨不懷好意。";
      "山寨東區隧道通往迷霧谷。";
      "山寨內部可能存在內應（未找到）。";
    ];

    (* --- Meta/Misc --- *)
    unspent_skill_points = Some 0; (* Assuming no point system *)
    unspent_attribute_points = Some 0; (* Assuming no point system *)
    special_flags = Some ["擁有現代知識背景"; "身負黑風寨興亡重任"; "與'雀'有精神鏈接(微弱/混亂)"; "掌握煉鋼關鍵技術"];
  };

  (* === 5. Non-Player Character States (NPCs) === *)
  (* ... To be provided in the next part ... *)

  (* ... other sections ... *)

} (* Partial snapshot end *)

(* === 5. Non-Player Character States (NPCs) === *)
  npc_states = [

    (* --- 1. 秦嵐 (Qin Lan) --- *)
    {
      npc_id = "qin_lan";
      npc_name = "秦嵐";
      is_key_character = true;
      npc_type = "醫護總管 (代理)";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base from snapshot R1084 + estimated changes *)
        hp = 250; max_hp = 250; base_max_hp = 250;
        mp = 180; max_mp = 180; base_max_mp = 180; (* Has some internal energy for basic healing? *)
        sta = 200; max_sta = 200; base_max_sta = 200; (* Recently rested? Assume moderate *)
        san = 380; max_san = 400; base_max_san = 400; (* Witnessing PC actions, Que's state causes stress *)
        fatigue = 20; max_fatigue = 100; (* Consistent work *)
        hunger = 10; max_hunger = 100; (* Assuming regular meals *)
        thirst = 10; max_thirst = 100; (* Assuming regular water *)
        morale = 75; max_morale = 100; (* Confident in skills, but worried *)
        stress = 35; max_stress = 100; (* Increased stress due to Que/PC state *)
        (* Other stats assumed normal *)
      };
      attributes = None; (* Assuming simplified stats *)

      skills = [ (* Base R1084 + gains from R1093, R1094, R1095, R1096, R1112, R1113 *)
        { skill_id="KM_BASIC_MEDICINE"; name_cn="基礎醫學"; category=Knowledge_Medical; level=6; proficiency=Some 6.8; mastery="駕輕就熟"; is_potential=false; description="處理常見傷病。" };
        { skill_id="KM_HERBALISM"; name_cn="草藥學"; category=Knowledge_Medical; level=5; proficiency=Some 5.5; mastery="登堂入室"; is_potential=false; description="辨識和使用草藥。" };
        { skill_id="KM_NURSING_CARE"; name_cn="基礎護理"; category=Knowledge_Medical; level=5; proficiency=Some 5.9; mastery="登堂入室"; is_potential=false; description="照料病患的技巧。(應用了現代知識指導)" };
        { skill_id="MI_QI_HEALING_BASIC"; name_cn="基礎內力療傷"; category=Martial_Internal; level=2; proficiency=Some 2.1; mastery="初學乍練"; is_potential=false; description="微弱內力輔助治療。" };
        { skill_id="GI_OBSERVATION"; name_cn="觀察"; category=General_Interaction; level=6; proficiency=Some 6.7; mastery="駕輕就熟"; is_potential=false; description="觀察細節，判斷狀況。" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = Some [ { item_id="item_tool_medical_kit_basic_01"; quantity=1; equipped=false; condition=0.8 } ]; (* Example *)
      currency = Some [("SilverLiang", 5)]; (* Example *)
      equipment = Some { (* Standard medic attire *)
          head = None; face = None; neck = None;
          torso = Some { item_id="item_armor_cloth_white_robe_01"; name="素白醫袍"; condition=0.9 };
          back = None;
          legs = Some { item_id="item_armor_pants_white_01"; name="素白長褲"; condition=0.9 };
          feet = Some { item_id="item_armor_shoes_cloth_01"; name="布鞋"; condition=0.8 };
          main_hand = None; off_hand = None; ranged_weapon = None; ammo = None;
          ring_1 = None; ring_2 = None; belt = None; pouch = None;
        };

      status_effects = []; (* Generally healthy *)

      current_location_id = "BWF_Infirmary_01"; (* Assumed starting point or heading to meeting *)
      current_location_name = "黑風寨．臨時傷兵安置點"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 檢查病患";
      current_posture = Some "Standing";
      mood = "擔憂 (Concerned) / 專業 (Professional) / 敬畏 (Awed)";
      short_term_goal = Some "向大當家匯報王大槌和'雀'的狀況。";
      long_term_goal = Some "提升醫術，治好王大槌，弄清'雀'的狀況。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity= (* ~Base+11 *); enmity= (* Base *); trust= (* ~Base+0.15 *); respect= (* ~Base+22 *); fear= (* Moderate? *); notes="關係極為複雜，尊敬和信任度高，有依賴感，但也對其手段和'雀'的狀況感到擔憂和不解。" };
        (* Other relationships assumed stable from R1084 *)
      ];

      ai_profile_id = Some "NPC_Healer_Diligent";
      ai_state = Some [("PatientPriorities", "WangDachui > Que > Others"); ("Task", "AttendMorningMeeting"); ("ConcernLevelPC", "High"); ("QueStatus", "Unchanged_Comatose_Monitored")];

      plot_importance = Some 8;
      known_player_knowledge = Some ["知道PC擁有特殊治療能力"; "知道PC重視'雀'"; "知道PC傳授了護理知識"; "知道PC預測'雀'可能甦醒"];
      special_flags = Some ["醫護總管(代理)"; "王大槌主要看護者"; "'雀'主要看護者"; "知道PC部分秘密"];
    };

    (* --- 2. 疤臉劉 (Scarface Liu) --- *)
    {
      npc_id = "ScarfaceLiu_Henchman";
      npc_name = "疤臉劉";
      is_key_character = true;
      npc_type = "衛隊統領 / PC親信";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 450; max_hp = 450; base_max_hp = 450; (* Veteran *)
        mp = 100; max_mp = 100; base_max_mp = 100; (* Basic internal user? *)
        sta = 400; max_sta = 400; base_max_sta = 400; (* Disciplined *)
        san = 350; max_san = 350; base_max_san = 350; (* Mentally tough *)
        fatigue = 15; max_fatigue = 100; (* Regular patrols/training *)
        hunger = 10; thirst = 10; (* Regular meals *)
        morale = 90; max_morale = 100; (* Highly loyal *)
        stress = 20; max_stress = 100; (* Constant vigilance *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1101, R1103 checks *)
        { skill_id="MW_BASE_BLADE"; name_cn="基礎刀法"; category=Martial_Weapon; level=8; proficiency=Some 8.7; mastery="駕輕就熟"; is_potential=false; description="擅長使用長刀。" };
        { skill_id="MF_BASE_FIST_FOOT"; name_cn="基礎拳腳"; category=Martial_FistAndFoot; level=7; proficiency=Some 7.5; mastery="駕輕就熟"; is_potential=false; description="基礎格鬥。" };
        { skill_id="MF_BLACKWIND_FIST_BASIC"; name_cn="黑風基礎拳"; category=Martial_FistAndFoot; level=2; proficiency=Some 2.5; mastery="初學乍練"; is_potential=false; description="正在學習和傳授中。" }; (* Assuming he learns fast *)
        { skill_id="Strategy_Leadership"; name_cn="基礎指揮"; category=Strategy_Leadership; level=6; proficiency=Some 6.3; mastery="登堂入室"; is_potential=false; description="指揮小隊作戰和巡邏。" };
        { skill_id="GI_INTIMIDATION"; name_cn="威嚇"; category=General_Interaction; level=7; proficiency=Some 7.1; mastery="駕輕就熟"; is_potential=false; description="氣勢懾人。" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None; (* Assumed standard gear *)
      currency = None;
      equipment = Some { (* Standard guard leader gear *)
          head = Some { item_id="item_armor_helmet_iron_worn_01"; name="舊鐵盔"; condition=0.7 };
          torso = Some { item_id="item_armor_leather_guard_01"; name="衛兵皮甲"; condition=0.8 };
          legs = Some { item_id="item_armor_pants_guard_01"; name="衛兵長褲"; condition=0.8 };
          feet = Some { item_id="item_armor_boots_leather_01"; name="皮靴"; condition=0.7 };
          main_hand = Some { item_id="item_weapon_saber_standard_01"; name="標準制式長刀"; condition=0.75 };
          (* ... other slots None *)
      };

      status_effects = [];

      current_location_id = "BWF_Barracks_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．兵營"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 巡視防務 / 督促訓練";
      current_posture = Some "Standing";
      mood = "嚴肅 (Serious) / 忠誠 (Loyal) / 警惕 (Vigilant)";
      short_term_goal = Some "確保山寨安全，執行大當家命令。";
      long_term_goal = Some "輔佐大當家壯大黑風寨，提升衛隊實力，找出內應。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* ~Base+0.05? *); respect=(* ~Base+9? *); fear=(* Moderate *); loyalty=(* Base + High Increase *); notes="忠誠度極高，對PC命令無條件服從，是PC最可靠的武力支柱。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_GuardCaptain_Loyal";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting"); ("SecurityLevel", "High"); ("MoleInvestigation", "NoProgress"); ("TrainingFocus", "BlackWindFist")];

      plot_importance = Some 9;
      known_player_knowledge = Some ["知道PC實力強大"; "知道處理'雀'的官方說法"; "知道煉鋼和礦石危機"];
      special_flags = Some ["衛隊統領"; "PC親信"; "忠誠"];
    };

    (* --- 3. 上官玉 (Shangguan Yu) --- *)
    {
      npc_id = "npc_shangguan_yu_01";
      npc_name = "上官玉";
      is_key_character = true;
      npc_type = "文書整理負責人 / 謀士型人才";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 280; max_hp = 280; base_max_hp = 280; (* Skilled fighter *)
        mp = 220; max_mp = 220; base_max_mp = 220; (* Potential for internal arts? *)
        sta = 250; max_sta = 250; base_max_sta = 250;
        san = 450; max_san = 450; base_max_san = 450; (* Mentally resilient, observant *)
        fatigue = 10; max_fatigue = 100; (* Primarily mental work *)
        hunger = 10; thirst = 10;
        morale = 70; max_morale = 100; (* Cautiously optimistic? *)
        stress = 25; max_stress = 100; (* Aware of寨中危機 *)
      };
      attributes = None;

      skills = [ (* Base R1084 + checks *)
        { skill_id="MW_BASE_SWORD"; name_cn="基礎劍法"; category=Martial_Weapon; level=7; proficiency=Some 7.2; mastery="駕輕就熟"; is_potential=false; description="使用劍的技巧。" };
        { skill_id="ML_BASE_LIGHTNESS"; name_cn="基礎輕功"; category=Martial_Lightness; level=6; proficiency=Some 6.8; mastery="登堂入室"; is_potential=false; description="身法靈活。" };
        { skill_id="Knowledge_Academic"; name_cn="學術知識 / 文書"; category=Knowledge_Academic; level=8; proficiency=Some 8.5; mastery="駕輕就熟"; is_potential=false; description="讀寫、整理、分析文書。" };
        { skill_id="Strategy_Analysis"; name_cn="分析 / 推理"; category=Strategy_Leadership; level=7; proficiency=Some 7.8; mastery="駕輕就熟"; is_potential=false; description="分析情報，推斷局勢。" };
        { skill_id="GI_OBSERVATION"; name_cn="觀察"; category=General_Interaction; level=8; proficiency=Some 8.1; mastery="駕輕就熟"; is_potential=false; description="觀察力敏銳。" };
        { skill_id="GI_PERSUASION"; name_cn="口才"; category=General_Interaction; level=6; proficiency=Some 6.5; mastery="登堂入室"; is_potential=false; description="言辭得體，善於表達。" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None; (* Assumed standard items + writing tools *)
      currency = None;
      equipment = Some { (* Quality clothing, perhaps a hidden weapon? *)
          head = None; face = None; neck = None;
          torso = Some { item_id="item_armor_cloth_scholar_moonwhite_01"; name="月白勁裝"; condition=0.95 };
          (* ... other slots likely cloth or empty *)
          main_hand = None;
      };

      status_effects = [];

      current_location_id = "BWF_DocumentRoom_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．文書房"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 整理舊檔案";
      current_posture = Some "Standing";
      mood = "平靜 (Calm) / 觀察 (Observant) / 謹慎 (Cautious)";
      short_term_goal = Some "繼續整理舊檔案，尋找有用信息。";
      long_term_goal = Some "輔佐大當家（待觀察），在亂世中尋找安身立命之處，了解黑風寨的潛力。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* ~Base+0.02+? *); respect=(* ~Base+7? *); fear=(* Low *); notes="對PC的能力感到驚訝和好奇，保持謹慎的合作態度，忠誠度有待考驗，但信任和尊敬度在提升。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Advisor_IntelligentCautious";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting"); ("DocumentSortingPhase", "Phase2_DeepArchive_Slow"); ("IntelAssessment", "LowValue_Pending")];

      plot_importance = Some 8;
      known_player_knowledge = Some ["知道PC具備特殊能力(部分)"; "知道PC重視情報和管理"; "知道煉鋼和礦石危機"; "知道王七任務終止"];
      special_flags = Some ["文書整理負責人"; "智囊型"; "來歷不明"];
    };

    (* --- 4. 老鐵匠 (Old Blacksmith) --- *)
    {
      npc_id = "Old_Blacksmith_01";
      npc_name = "老鐵匠";
      is_key_character = true;
      npc_type = "首席鐵匠 / 技術核心";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated from forging *)
        hp = 300; max_hp = 300; base_max_hp = 300; (* Robust from labor *)
        mp = 50; max_mp = 50; base_max_mp = 50; (* No internal energy *)
        sta = 250; max_sta = 350; base_max_sta = 350; (* High base stamina, currently taxed from R1104 *)
        san = 300; max_san = 300; base_max_san = 300;
        fatigue = 40; max_fatigue = 100; (* High from R1104, maybe worked overnight? *)
        hunger = 20; thirst = 30; (* Likely prioritized work over meals *)
        morale = 95; max_morale = 100; (* Extremely high due to steel breakthrough & new ore *)
        stress = 10; max_stress = 100; (* Hope replaces stress *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1092, R1104, R1111 gains *)
        { skill_id="PA_FORGING"; name_cn="鍛造"; category=Production_Advanced; level=8; proficiency=Some 8.8; mastery="駕輕就熟"; is_potential=false; description="精通各種金屬的鍛打成型。" };
        { skill_id="PA_METAL_TREATMENT"; name_cn="金屬處理"; category=Production_Advanced; level=7; proficiency=Some 7.9; mastery="駕輕就熟"; is_potential=false; description="掌握淬火、退火等熱處理技術。" };
        { skill_id="PA_SMELTING"; name_cn="基礎熔煉"; category=Production_Primary; level=7; proficiency=Some 7.5; mastery="駕輕就熟"; is_potential=false; description="從礦石中提取金屬。" };
        { skill_id="PA_TOOL_MAKING"; name_cn="工具製造"; category=Production_Advanced; level=8; proficiency=Some 8.2; mastery="駕輕就熟"; is_potential=false; description="擅長打造各類工具。" };
        { skill_id="PA_WEAPON_MAKING"; name_cn="武器製造"; category=Production_Advanced; level=7; proficiency=Some 7.8; mastery="駕輕就熟"; is_potential=false; description="擅長打造常用兵器。" };
        { skill_id="POT_STEELMAKING_CONCEPT"; name_cn="煉鋼(概念)"; category=Conceptual; level=1; proficiency=Some 1.0; mastery="初窺門徑"; is_potential=true; description="領悟了通過控制碳含量煉製鋼鐵的方法。" }; (* Gained Skill! *)
         { skill_id="POT_MATERIALS_SCIENCE_CONCEPT"; name_cn="材料學(潛力)"; category=Conceptual; level=0?; proficiency=Some 0.05?; mastery="尚未掌握?"; is_potential=true; description="對材料特性的理解潛力。" };
     ];
      abilities = None;

      inventory = Some [ { item_id="item_tool_hammer_blacksmith_01"; quantity=1; equipped=true; condition=0.8 } ]; (* Example *)
      currency = None;
      equipment = Some { (* Standard blacksmith attire *)
          torso = Some { item_id="item_armor_apron_leather_01"; name="皮圍裙"; condition=0.6 };
          (* ... other slots likely basic cloth *)
      };

      status_effects = [ { effect_id="Status_Fatigued_Moderate"; description="中度疲勞" } ]; (* From R1104/R1111 *)

      current_location_id = "BWF_Forge_01";
      current_location_name = "黑風寨．鐵匠鋪";
      current_action = "全力趕工打造【鋼鎬】";
      current_posture = Some "Standing";
      mood = "極度興奮 (Extremely Excited) / 專注 (Focused) / 疲憊但亢奮 (Tired but Eager)";
      short_term_goal = Some "用新到的礦石和精炭，打造出足夠的鋼鎬！";
      long_term_goal = Some "徹底掌握煉鋼技術，為山寨打造神兵利器！";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* ~Base+33 *); enmity=(* Base *); trust=(* 1.0 - Max *); respect=(* 1.0 - Max *); fear=(* Low - replaced by awe *); notes="視PC為傳授無上技藝的宗師，忠誠、信任、尊敬均達頂點。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Craftsman_Master_Inspired";
      ai_state = Some [("CurrentTask", "ForgeSteelPickaxes"); ("MaterialStatus", "OreAvailable_CharcoalAvailable"); ("TechFocus", "SteelmakingExperimentation")];

      plot_importance = Some 9; (* Critical for production *)
      known_player_knowledge = Some ["知道PC擁有超越時代的冶煉知識"; "知道精炭的優越性"; "掌握了初步的煉鋼方法"];
      special_flags = Some ["首席鐵匠"; "掌握煉鋼概念"; "技術突破關鍵人物"];
    };

    (* --- 5. 黃金寶 (Huang Jinbao) --- *)
    {
      npc_id = "HuangJinbao";
      npc_name = "黃金寶";
      is_key_character = true;
      npc_type = "礦隊隊長 / 狂信徒";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated mining labor *)
        hp = 380; max_hp = 380; base_max_hp = 380; (* Strong physique *)
        mp = 30; max_mp = 30; base_max_mp = 30; (* Minimal *)
        sta = 300; max_sta = 400; base_max_sta = 400; (* Taxed by recent efforts *)
        san = 250; max_san = 300; base_max_san = 300; (* Fanaticism provides resilience but unstable? *)
        fatigue = 50; max_fatigue = 100; (* High due to mining + pressure *)
        hunger = 30; thirst = 40; (* Likely neglected needs *)
        morale = 100; max_morale = 100; (* Fanatically high *)
        stress = 60; max_stress = 100; (* High pressure to perform *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1090, R1101, R1109, R1110 gains *)
        { skill_id="PA_MINING_BASIC"; name_cn="基礎採礦"; category=Production_Primary; level=5; proficiency=Some 5.1; mastery="登堂入室"; is_potential=false; description="挖掘礦石的基礎技巧。(使用鋼鎬提升)" };
        { skill_id="GI_INTIMIDATION"; name_cn="威嚇"; category=General_Interaction; level=6; proficiency=Some 6.5; mastery="登堂入室"; is_potential=false; description="恐嚇礦工和囚犯。" };
        { skill_id="Strategy_LaborSupervision"; name_cn="勞力監督"; category=Strategy_Leadership; level=4; proficiency=Some 4.1; mastery="初窺門徑"; is_potential=false; description="監督他人勞作，效率不高。" };
        { skill_id="MF_BASE_FIST_FOOT"; name_cn="基礎拳腳"; category=Martial_FistAndFoot; level=5; proficiency=Some 5.2; mastery="登堂入室"; is_potential=false; description="有一些粗淺功夫。" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = Some { (* Basic clothing + steel pickaxe *)
          main_hand = Some { item_id="item_tool_pickaxe_steel_proto_01"; name="鋼鎬原型"; condition=0.95? }; (* Has one of the two prototypes *)
          (* ... other slots likely basic cloth/leather *)
      };

      status_effects = [ { effect_id="Status_Fatigued_Moderate"; description="中度疲勞" } ];

      current_location_id = "BWF_Mine_EastTunnel_01";
      current_location_name = "黑風寨．東區礦洞";
      current_action = "狂熱地監督/參與採礦，執行激勵政策";
      current_posture = Some "Standing";
      mood = "狂熱 (Fanatical) / 興奮 (Excited) / 壓力山大 (Pressured)";
      short_term_goal = Some "最大化礦石產量，執行聖主命令！";
      long_term_goal = Some "為聖主（阿宅）獻上一切！";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* ~Base+0.15+? *); respect=(* ~Base+49+? Max *); fear=(* High *); loyalty=(* Max - Fanatical *); fanaticism=(* ~Base+37? High *); notes="對PC極度狂熱和崇拜，執行力強，但方法粗暴，缺乏智慧。" };
        { target_id="PrisonerGroup"; target_name="囚犯礦工"; affinity=-50.0; enmity=70.0; trust=-1.0; respect=-1.0; fear=80.0; notes="高壓統治，關係惡劣。" };
      ];

      ai_profile_id = Some "NPC_Foreman_Fanatic";
      ai_state = Some [("CurrentTask", "SuperviseMining_MaximizeOutput"); ("IncentiveSystem", "Active"); ("ToolStatus", "HasSteelPickaxe")];

      plot_importance = Some 7; (* Key for resource bottleneck *)
      known_player_knowledge = Some ["知道PC擁有神力"; "知道煉鋼成功"; "知道新激勵政策"; "持有鋼鎬原型"];
      special_flags = Some ["礦隊隊長"; "狂信徒"; "持有鋼鎬原型"];
    };

    (* --- 6. 周平 (Zhou Ping) --- *)
    {
      npc_id = "ZhouPing_KilnMaster";
      npc_name = "周平";
      is_key_character = true;
      npc_type = "炭窯總管 / 技術人員";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 320; max_hp = 320; base_max_hp = 320;
        mp = 40; max_mp = 40; base_max_mp = 40;
        sta = 350; max_sta = 350; base_max_sta = 350;
        san = 330; max_san = 330; base_max_san = 330;
        fatigue = 25; max_fatigue = 100; (* Preparing 2nd batch *)
        hunger = 15; thirst = 15;
        morale = 90; max_morale = 100; (* High from success *)
        stress = 30; max_stress = 100; (* Pressure for wood supply / new kiln *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1092, R1101, R1103 updates *)
        { skill_id="PA_CHARCOAL_MAKING"; name_cn="燒炭"; category=Production_Primary; level=8; proficiency=Some 8.5; mastery="駕輕就熟"; is_potential=false; description="精通木炭及精炭燒製。(掌握精炭法)" };
        { skill_id="PA_KILN_CONSTRUCTION"; name_cn="窯爐建造"; category=Production_Advanced; level=4; proficiency=Some 4.2; mastery="初窺門徑"; is_potential=false; description="建造和維護窯爐。(應用了改良設計)" };
        { skill_id="POT_ENGINEERING_CONCEPT"; name_cn="工程學概念(潛力)"; category=Conceptual; level=0?; proficiency=Some 0.1; mastery="尚未掌握?"; is_potential=true; description="對工程原理的理解。" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = None; (* Basic worker clothes *)

      status_effects = [];

      current_location_id = "BWF_Kiln_Area_01";
      current_location_name = "黑風寨．後山炭窯區";
      current_action = "準備第二爐精炭燒製 / 督促新窯挖掘";
      current_posture = Some "Standing";
      mood = "興奮 (Excited) / 專注 (Focused) / 期待 (Expectant)";
      short_term_goal = Some "成功燒製第二爐精炭，加快新窯建設。";
      long_term_goal = Some "掌握精炭量產技術，為山寨提供充足燃料。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* ~Base+5 *); enmity=(* Base *); trust=(* ~Base+0.13 *); respect=(* ~Base+26 *); fear=(* Low *); notes="對PC的技術極度信服和崇拜，工作熱情高。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Craftsman_Lead_Diligent";
      ai_state = Some [("CurrentTask", "PrepareKilnBatch2"); ("MaterialStatus", "AwaitingWood"); ("ConstructionTask", "NewKiln_Slow")];

      plot_importance = Some 8; (* Key for fuel production *)
      known_player_knowledge = Some ["知道PC傳授的精炭燒製法和窯爐設計"; "知道煉鋼成功和礦石危機"];
      special_flags = Some ["炭窯總管"; "掌握精炭技術"];
    };

    (* ... More NPCs to follow ... *)
  ] (* Partial NPC list end *)

  (* === 6. Location States === *)
  (* ... To be provided in subsequent parts ... *)

  (* ... other sections ... *)

} (* Partial snapshot end *)

(* Continuing npc_states list from Part 3 *)

    (* --- 7. 劉三猴 (Liu Sanhou) --- *)
    {
      npc_id = "LiuSanhou_Logistics";
      npc_name = "劉三猴";
      is_key_character = true;
      npc_type = "後勤總管(臨時) / 悔過隊監工";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 280; max_hp = 280; base_max_hp = 280;
        mp = 20; max_mp = 20; base_max_mp = 20;
        sta = 300; max_sta = 300; base_max_sta = 300;
        san = 280; max_san = 300; base_max_san = 300; (* Stress from multiple tasks *)
        fatigue = 30; max_fatigue = 100; (* Running logistics is tiring *)
        hunger = 15; thirst = 15;
        morale = 65; max_morale = 100; (* Hopeful but stressed *)
        stress = 45; max_stress = 100; (* Burdened by tasks/failures *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1090, R1101, R1103 checks *)
        { skill_id="Strategy_Logistics_Basic"; name_cn="基礎後勤管理"; category=Strategy_Leadership; level=4; proficiency=Some 4.3; mastery="初窺門徑"; is_potential=false; description="管理物資進出和分配。(經驗增加)" };
        { skill_id="Strategy_LaborSupervision"; name_cn="勞力監督"; category=Strategy_Leadership; level=3; proficiency=Some 3.5; mastery="初窺門徑"; is_potential=false; description="監督悔過隊和雜役工作。" };
        { skill_id="SC_BASIC_CRAFTING"; name_cn="基礎手工"; category=Survival_Crafting; level=2; proficiency=Some 2.8; mastery="初學乍練"; is_potential=false; description="嘗試製作肥皂等。(多次失敗)" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = None; (* Basic clothes *)

      status_effects = [ { effect_id="Status_Stressed_Moderate"; description="中度壓力" } ];

      current_location_id = "BWF_Warehouse_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．倉庫區"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 盤點物資 / 安排雜役";
      current_posture = Some "Standing";
      mood = "焦慮 (Anxious) / 諂媚 (Fawning) / 期待 (Expectant - re: Soap)";
      short_term_goal = Some "完成物資分配，解決肥皂問題，獲得挖掘工具。";
      long_term_goal = Some "穩固後勤總管位置，獲得大當家信任。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* ~Base+? *); enmity=(* Base *); trust=(* ~Base+0.01? *); respect=(* ~Base+4? *); fear=(* Moderate *); notes="對PC感到敬畏，渴望得到指導和肯定。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Manager_Logistics_Stressed";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting"); ("SoapTask", "PendingPCGuidance"); ("BurialTask", "Blocked_NoTools"); ("GreaseCollection", "Ongoing")];

      plot_importance = Some 6; (* Important for logistics *)
      known_player_knowledge = Some ["知道PC承諾指導肥皂"; "知道山寨缺工具"; "知道礦石危機已緩解"];
      special_flags = Some ["後勤總管(臨時)"; "悔過隊監工"];
    };

    (* --- 8. 石敢 (Shi Gan) --- *)
    {
      npc_id = "ShiGan_LoggingLeader";
      npc_name = "石敢";
      is_key_character = true;
      npc_type = "伐木隊長";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 350; max_hp = 350; base_max_hp = 350; (* Strong *)
        mp = 30; max_mp = 30; base_max_mp = 30;
        sta = 380; max_sta = 400; base_max_sta = 400; (* Good stamina *)
        san = 320; max_san = 320; base_max_san = 320;
        fatigue = 35; max_fatigue = 100; (* Heavy labor *)
        hunger = 20; thirst = 25;
        morale = 70; max_morale = 100; (* Stressed but loyal *)
        stress = 50; max_stress = 100; (* High due to demand/tool shortage *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1090, R1101, R1103 checks *)
        { skill_id="PA_LOGGING"; name_cn="伐木"; category=Production_Primary; level=7; proficiency=Some 7.4; mastery="駕輕就熟"; is_potential=false; description="砍伐樹木的技巧。" };
        { skill_id="Strategy_LaborSupervision"; name_cn="勞力監督"; category=Strategy_Leadership; level=5; proficiency=Some 5.1; mastery="登堂入室"; is_potential=false; description="管理伐木隊員。" };
        { skill_id="GM_CARRYING"; name_cn="運搬"; category=General_Movement; level=6; proficiency=Some 6.6; mastery="登堂入室"; is_potential=false; description="搬運沉重木材。" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = Some { (* Lumberjack gear *)
          main_hand = Some { item_id="item_tool_axe_iron_worn_01"; name="舊鐵斧"; condition=0.4 }; (* Axe condition critical *)
          (* ... other slots basic cloth/leather *)
      };

      status_effects = [ { effect_id="Status_Stressed_Moderate"; description="中度壓力(工具短缺)" } ];

      current_location_id = "BWF_LoggingCamp_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．伐木場"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 安排伐木任務";
      current_posture = Some "Standing";
      mood = "沉穩 (Steady) / 擔憂 (Worried) / 壓力 (Pressured)";
      short_term_goal = Some "滿足炭窯的木材需求，獲取新的斧頭。";
      long_term_goal = Some "確保山寨木材供應穩定。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* ~Base+0.01? *); respect=(* ~Base+4? *); fear=(* Low *); notes="務實可靠的隊長，對PC尊敬，但因工具問題感到壓力。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Foreman_Reliable";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting"); ("WoodDemand", "High_BarelyMeeting"); ("ToolStatus", "AxeShortage_Critical")];

      plot_importance = Some 7; (* Key for fuel supply chain *)
      known_player_knowledge = Some ["知道獨輪車和接力法"; "知道精炭需要大量木材"; "知道山寨缺鐵器"];
      special_flags = Some ["伐木隊長"];
    };

    (* --- 9. 劉二 (Liu Er) --- *)
    {
      npc_id = "LiuEr_TransportLeader";
      npc_name = "劉二";
      is_key_character = true;
      npc_type = "運輸隊長";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 300; max_hp = 300; base_max_hp = 300;
        mp = 20; max_mp = 20; base_max_mp = 20;
        sta = 400; max_sta = 400; base_max_sta = 400; (* Transport requires stamina *)
        san = 310; max_san = 310; base_max_san = 310;
        fatigue = 20; max_fatigue = 100; (* Constant movement *)
        hunger = 10; thirst = 10;
        morale = 80; max_morale = 100; (* Seeing progress *)
        stress = 15; max_stress = 100; (* Low stress if tasks are clear *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1090, R1101, R1103, R1108, R1110 checks *)
        { skill_id="Strategy_Logistics_Transport"; name_cn="運輸協調"; category=Strategy_Leadership; level=5; proficiency=Some 5.2; mastery="登堂入室"; is_potential=false; description="規劃和執行物資運輸路線。(經驗增加)" };
        { skill_id="GM_CARRYING"; name_cn="運搬"; category=General_Movement; level=7; proficiency=Some 7.1; mastery="駕輕就熟"; is_potential=false; description="熟練使用獨輪車等工具搬運。" };
         { skill_id="Strategy_Leadership_Basic"; name_cn="基礎領導"; category=Strategy_Leadership; level=4; proficiency=Some 4.0; mastery="初窺門徑"; is_potential=false; description="管理運輸小隊(5人)。" };
       (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = None; (* Basic worker clothes *)

      status_effects = [];

      current_location_id = "BWF_TransportHub_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．運輸集散點"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 指揮運輸隊運輸礦石";
      current_posture = Some "Standing";
      mood = "積極 (Active) / 幹勁十足 (Motivated)";
      short_term_goal = Some "將新挖出的礦石高效運往鐵匠鋪。";
      long_term_goal = Some "建立高效的山寨物資運輸網絡。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* ~Base+0.01? *); respect=(* ~Base+5? *); fear=(* Low *); notes="對PC指令積極響應，執行力強。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Coordinator_Diligent";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting / TransportOre"); ("TeamStatus", "Operational"); ("Bottleneck", "OreSupplyRate")];

      plot_importance = Some 6; (* Important for logistics flow *)
      known_player_knowledge = Some ["知道獨輪車用法"; "知道礦石和精炭的重要性"; "知道礦區產量激增"];
      special_flags = Some ["運輸隊長"];
    };

    (* --- 10. 空空兒 (KongKongEr) --- *)
    {
      npc_id = "KongKongEr_01";
      npc_name = "空空兒";
      is_key_character = true;
      npc_type = "巧匠 / 學徒";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 260; max_hp = 260; base_max_hp = 260; (* Young, average build *)
        mp = 80; max_mp = 80; base_max_mp = 80; (* Potential for internal mechanics? *)
        sta = 280; max_sta = 280; base_max_sta = 280;
        san = 350; max_san = 350; base_max_san = 350; (* Curious, observant *)
        fatigue = 15; max_fatigue = 100; (* Woodworking, observed forging *)
        hunger = 10; thirst = 10;
        morale = 85; max_morale = 100; (* Inspired by PC *)
        stress = 10; max_stress = 100; (* Focused on learning *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1090, R1092, R1103, R1104, R1111 checks *)
        { skill_id="SC_WOODWORKING"; name_cn="木工"; category=Survival_Crafting; level=6; proficiency=Some 6.8; mastery="登堂入室"; is_potential=false; description="製作木製工具和物品（獨輪車/木鍬）。" };
        { skill_id="PA_BASIC_MECHANICS"; name_cn="基礎機械原理"; category=Production_Advanced; level=3; proficiency=Some 3.5; mastery="初窺門徑"; is_potential=false; description="理解簡單機械結構。" };
        { skill_id="POT_ENGINEERING_CONCEPT"; name_cn="工程學概念(潛力)"; category=Conceptual; level=1?; proficiency=Some 0.3; mastery="初學乍練?"; is_potential=true; description="對工程原理的理解。(提升)" };
        { skill_id="PA_FORGING_BASIC"; name_cn="基礎鍛造"; category=Production_Advanced; level=1; proficiency=Some 1.1; mastery="初學乍練"; is_potential=false; description="觀摩學習鍛造。(R1111 +0.1)" };
        (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = None; (* Basic clothes *)

      status_effects = [];

      current_location_id = "BWF_Workshop_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．工匠作坊"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 製作獨輪車 / 思考新工具";
      current_posture = Some "Standing";
      mood = "好奇 (Curious) / 專注 (Focused) / 渴望學習 (Eager to Learn)";
      short_term_goal = Some "繼續製作獨輪車，獲取鐵料製作更好零件。";
      long_term_goal = Some "學習更多精巧技藝，成為像大當家一樣厲害的人。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* ~Base+5? *); enmity=(* Base *); trust=(* ~Base+0.08? *); respect=(* ~Base+23? *); fear=(* Low *); notes="對PC的智慧和技術極度欽佩，渴望學習，尊敬度很高。" };
        { target_id="Old_Blacksmith_01"; target_name="老鐵匠"; affinity=10.0; enmity=0.0; trust=0.5; respect=0.8; notes="尊敬的師傅輩。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Craftsman_Apprentice_Bright";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting / BuildWheelbarrows"); ("MaterialNeeds", "Iron_Components"); ("LearningFocus", "Forge_Engineering")];

      plot_importance = Some 7; (* Key for tool/structure making *)
      known_player_knowledge = Some ["知道獨輪車設計"; "知道改良木鍬"; "目睹煉鋼過程"; "知道鐵料匱乏"];
      special_flags = Some ["巧匠"; "學習能力強"];
    };

    (* --- 11. 馬六 (Ma Liu) --- *)
    {
      npc_id = "MaLiu_Hunter";
      npc_name = "馬六";
      is_key_character = true;
      npc_type = "獵戶隊長";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 330; max_hp = 330; base_max_hp = 330; (* Hunter's constitution *)
        mp = 20; max_mp = 20; base_max_mp = 20;
        sta = 360; max_sta = 360; base_max_sta = 360; (* Needs stamina for tracking *)
        san = 300; max_san = 300; base_max_san = 300;
        fatigue = 20; max_fatigue = 100; (* Regular hunting *)
        hunger = 15; thirst = 15;
        morale = 75; max_morale = 100; (* Steady *)
        stress = 20; max_stress = 100; (* Normal hunting pressure *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1090, R1101 checks *)
        { skill_id="SG_HUNTING"; name_cn="狩獵"; category=Survival_Gathering; level=7; proficiency=Some 7.5; mastery="駕輕就熟"; is_potential=false; description="追蹤和獵殺野獸。" };
        { skill_id="SG_TRAPPING"; name_cn="陷阱製作"; category=Survival_Gathering; level=6; proficiency=Some 6.3; mastery="登堂入室"; is_potential=false; description="製作和佈置陷阱。" };
        { skill_id="GM_STEALTH"; name_cn="潛行"; category=General_Movement; level=5; proficiency=Some 5.8; mastery="登堂入室"; is_potential=false; description="在山林中隱蔽追蹤。" };
         { skill_id="POT_ANIMAL_HUSBANDRY_CONCEPT"; name_cn="動物飼養(概念)"; category=Conceptual; level=0?; proficiency=Some 0.1; mastery="尚未掌握?"; is_potential=true; description="嘗試理解和實踐飼養活捉動物。" };
       (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = Some [ { item_id="item_weapon_bow_hunting_01"; quantity=1; equipped=true; condition=0.7 } ]; (* Example *)
      currency = None;
      equipment = Some { (* Hunter gear *)
          main_hand = Some { item_id="item_weapon_bow_hunting_01"; name="獵弓"; condition=0.7 };
          ammo = Some { item_id="item_ammo_arrow_hunting_01"; name="獵箭"; quantity=15 };
          (* ... other slots likely leather/cloth *)
      };

      status_effects = [];

      current_location_id = "BWF_HuntingGrounds_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．周邊山林"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 檢查陷阱 / 尋找獵物";
      current_posture = Some "Standing";
      mood = "務實 (Practical) / 平靜 (Calm)";
      short_term_goal = Some "提供穩定的肉食來源，嘗試活捉動物。";
      long_term_goal = Some "建立山寨的肉食供應體系（包括可能的飼養）。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* ~Base+0.01? *); respect=(* ~Base+4? *); fear=(* Low *); notes="可靠的獵戶，聽從命令，對新任務有待學習。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_Hunter_Reliable";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting / Hunting"); ("AnimalCaptureTask", "PendingGuidance_Resources")];

      plot_importance = Some 6; (* Important for food supply *)
      known_player_knowledge = Some ["知道PC要求活捉動物"; "知道山寨需要肉食"];
      special_flags = Some ["獵戶隊長"; "負責動物飼養(新)"];
    };

    (* --- 12. 馬奎 (Ma Kui) --- *)
    {
      npc_id = "MaKui_MineGuardLeader";
      npc_name = "馬奎";
      is_key_character = false; (* Less key than Scarface *)
      npc_type = "礦區守衛隊長";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Base R1084 + estimated *)
        hp = 400; max_hp = 400; base_max_hp = 400; (* Guard captain *)
        mp = 50; max_mp = 50; base_max_mp = 50;
        sta = 380; max_sta = 380; base_max_sta = 380;
        san = 300; max_san = 300; base_max_san = 300;
        fatigue = 15; max_fatigue = 100; (* Guard duty *)
        hunger = 10; thirst = 10;
        morale = 80; max_morale = 100; (* Seeing results *)
        stress = 25; max_stress = 100; (* Watching prisoners *)
      };
      attributes = None;

      skills = [ (* Base R1084 + R1090, R1101 checks *)
         { skill_id="MW_BASE_SPEAR"; name_cn="基礎槍法"; category=Martial_Weapon; level=6; proficiency=Some 6.1; mastery="登堂入室"; is_potential=false; description="使用長槍守衛。" };
         { skill_id="Strategy_GuardDuty"; name_cn="守衛勤務"; category=Strategy_Leadership; level=6; proficiency=Some 6.4; mastery="登堂入室"; is_potential=false; description="執行警戒和守衛任務。" };
         (* Other skills from base snapshot *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = Some { (* Standard guard gear *)
          main_hand = Some { item_id="item_weapon_spear_iron_01"; name="鐵矛"; condition=0.6 }; (* Weapon likely poor condition *)
          (* ... other slots similar to Scarface Liu *)
      };

      status_effects = [];

      current_location_id = "BWF_Mine_Entrance_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．礦洞入口"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 站崗守衛";
      current_posture = Some "Standing";
      mood = "警惕 (Vigilant) / 嚴肅 (Serious)";
      short_term_goal = Some "確保礦區入口安全，管理囚犯進出。";
      long_term_goal = Some "維持礦區秩序。";

      relationships = [ (* Values based on PC state aggregation *)
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* Base *); respect=(* ~Base+4? *); fear=(* Moderate *); notes="執行命令的守衛隊長。" };
        { target_id="HuangJinbao"; target_name="黃金寶"; affinity=5.0; enmity=0.0; trust=0.3; respect=0.4; notes="工作配合關係。" };
        { target_id="PrisonerGroup"; target_name="囚犯礦工"; affinity=-20.0; enmity=30.0; trust=-0.5; respect=-0.5; fear=60.0; notes="監管關係。" };
        (* Other relationships assumed stable *)
      ];

      ai_profile_id = Some "NPC_GuardLeader_Standard";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting / GuardMine"); ("PrisonerStatus", "Managed")];

      plot_importance = Some 5; (* Security role *)
      known_player_knowledge = Some ["知道PC重視礦區"; "知道囚犯在挖礦"; "知道產量增加了"];
      special_flags = Some ["礦區守衛隊長"];
    };

    (* --- 13. 雀 (Que) --- *)
    {
      npc_id = "Que_Assassin";
      npc_name = "雀";
      is_key_character = true;
      npc_type = "影巢刺客 (俘虜)";
      faction_id = Some "shadow_nest"; (* Still technically? *)
      npc_level = None; npc_xp = None;

      core_stats = { (* Based on R1113 state *)
        hp = 300; max_hp = 300; base_max_hp = 300; (* Physically stabilized *)
        mp = 10; max_mp = 250?; base_max_mp = 250?; (* Severely depleted/damaged *)
        sta = 150; max_sta = 150; base_max_sta = 150; (* Weakened by coma *)
        san = 50; max_san = 400?; base_max_san = 400?; (* Critically low / Chaotic *)
        fatigue = 90; max_fatigue = 100; (* Comatose state *)
        hunger = 20; thirst = 20; (* Maintained by nursing? *)
        morale = 10; max_morale = 100; (* Unconscious *)
        stress = 90; max_stress = 100; (* Subconscious trauma/mutation *)
      };
      attributes = None;

      skills = [ (* Assume base skills intact but unusable *)
         { skill_id="MW_DAGGER_ASSASSIN"; name_cn="刺客匕首術"; category=Martial_Weapon; level=8; proficiency=None; mastery="駕輕就熟"; is_potential=false; description="致命的匕首技巧。" };
         { skill_id="ML_SHADOW_STEP"; name_cn="影步"; category=Martial_Lightness; level=7; proficiency=None; mastery="駕輕就熟"; is_potential=false; description="潛行和閃避身法。" };
         { skill_id="MI_ASSASSIN_INTERNAL"; name_cn="刺客內功"; category=Martial_Internal; level=6; proficiency=None; mastery="登堂入室"; is_potential=false; description="隱匿氣息，強化爆發。" };
         { skill_id="SPECIAL_POISON_USE"; name_cn="用毒"; category=Special; level=5; proficiency=None; mastery="登堂入室"; is_potential=false; description="使用和辨識毒藥。" };
         (* ... other skills *)
      ];
      abilities = Some [ { ability_id="TALENT_PAIN_RESISTANCE"; name_cn="痛苦忍耐"; type_=`Passive_Talent; description="對痛苦有較高忍耐力。"; level=None; proficiency=None; mastery="天賦"; is_potential=false } ];

      inventory = None; (* Items likely confiscated *)
      currency = None;
      equipment = Some { (* Simple patient clothes *)
          torso = Some { item_id="item_armor_cloth_patient_gown_01"; name="病號服"; condition=1.0 };
      };

      status_effects = [
        { effect_id="Status_Comatose"; description="深度昏迷" };
        { effect_id="Status_SevereMentalTrauma"; description="嚴重精神創傷" };
        { effect_id="Status_BrainMutation_Suspected"; description="腦部異變（疑似）" };
        { effect_id="Status_MemoryInfused_Latent"; description="記憶灌輸潛伏影響（愛戀/守護指令）" };
      ];

      current_location_id = "BWF_Infirmary_01";
      current_location_name = "黑風寨．臨時傷兵安置點";
      current_action = "昏迷不醒 (Comatose)";
      current_posture = Some "Lying";
      mood = "混沌 (Chaotic) / 無意識 (Unconscious)";
      short_term_goal = None;
      long_term_goal = None;

      relationships = [
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Highly complex/volatile *); enmity=(* High base + Trauma *); trust=(* Extremely Low *); respect=(* None *); fear=(* High Subconscious? *); loyalty=(* High - Latent/Infused *); notes="關係極度扭曲和危險。PC是造成她現狀的直接原因，但也植入了忠誠指令。是重要的情報來源和潛在威脅/資產。" };
        { target_id="qin_lan"; target_name="秦嵐"; affinity=0.0; enmity=0.0; trust=0.0; respect=0.0; notes="醫患關係(單方面)。" };
      ];

      ai_profile_id = None; (* No active AI *)
      ai_state = None;

      plot_importance = Some 10; (* Major plot character *)
      known_player_knowledge = None;
      special_flags = Some ["影巢刺客"; "俘虜"; "記憶被灌輸"; "腦部異變中"; "深度昏迷"];
    };

    (* --- 14. 王大槌 (Wang Dachui) --- *)
    {
      npc_id = "WangDachui_01";
      npc_name = "王大槌";
      is_key_character = true;
      npc_type = "前任統領 (重傷恢復中)";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;

      core_stats = { (* Based on R1113 state *)
        hp = 200; max_hp = 250; base_max_hp = 250; (* Still recovering from near death *)
        mp = 20; max_mp = 20; base_max_mp = 20;
        sta = 100; max_sta = 150; base_max_sta = 150; (* Weak from injury/bedrest *)
        san = 280; max_san = 300; base_max_san = 300; (* Trauma from near death? *)
        fatigue = 70; max_fatigue = 100; (* Bedridden state *)
        hunger = 15; thirst = 15; (* Fed by nursing care *)
        morale = 60; max_morale = 100; (* Recovering, hopeful? *)
        stress = 40; max_stress = 100; (* Pain/discomfort/memory? *)
      };
      attributes = None;

      skills = [ (* Base R1084 *)
        { skill_id="PA_FORGING_BASIC"; name_cn="基礎拳腳"; category=Production_Advanced; level=6; proficiency=Some 6.1; mastery="融會貫通"; is_potential=false; description="拳腳的基本功。" };
        (* Other skills likely very basic *)
      ];
      abilities = None;

      inventory = None;
      currency = None;
      equipment = Some { (* Patient clothes *)
          torso = Some { item_id="item_armor_cloth_patient_gown_01"; name="病號服"; condition=1.0 };
      };

      status_effects = [
        { effect_id="Status_Injured_Severe_Recovering"; description="重傷恢復中" };
        { effect_id="Status_Weakened"; description="身體虛弱" };
        { effect_id="Status_Aphasia_Recovering"; description="失語症恢復期（接近恢復）" };
      ];

      current_location_id = "BWF_Infirmary_01";
      current_location_name = "黑風寨．臨時傷兵安置點";
      current_action = "臥床休養 / 嘗試發聲";
      current_posture = Some "Lying";
      mood = "迷茫 (Confused) / 努力 (Trying) / 疼痛 (Pained)";
      short_term_goal = Some "恢復說話能力。";
      long_term_goal = Some "完全康復，弄清狀況。";

      relationships = [
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Unknown - Depends on recovery *); enmity=(* Unknown *); trust=(* Unknown *); respect=(* Unknown *); fear=(* Unknown *); notes="尚無法清晰表達，對PC認知模糊。" };
        { target_id="qin_lan"; target_name="秦嵐"; affinity=15.0; enmity=0.0; trust=0.6; respect=0.5; notes="感激她的照料。" };
        { target_id="zhuo_yingxue"; target_name="卓映雪"; affinity=70.0?; enmity=0.0; trust=0.8?; respect=0.3?; notes="關係密切（青梅竹馬？），是其重要牽掛。" };
      ];

      ai_profile_id = None; (* Minimal AI while recovering *)
      ai_state = None;

      plot_importance = Some 9; (* Key potential informant *)
      known_player_knowledge = Some ["可能知道卓映雪來探望過"]; (* Vague memory *)
      special_flags = Some ["重傷恢復中"; "前任統領"; "接近甦醒"; "認識卓映雪"; "可能知道影爪線索"];
    };

    (* --- 15. 孫計 (Sun Ji) & 吳用 (Wu Yong) --- *)
    { (* Combined entry for brevity, individual entries preferred for full detail *)
      npc_id = "SunJi_WuYong_Scribes";
      npc_name = "孫計 & 吳用";
      is_key_character = false;
      npc_type = "文書 / 賬房";
      faction_id = Some "black_wind_fortress";
      npc_level = None; npc_xp = None;
      core_stats = { (* Generic stats *) hp=150; max_hp=150; mp=50; max_mp=50; sta=150; max_sta=150; san=250; max_san=250; fatigue=10; hunger=10; thirst=10; morale=70; stress=20; };
      attributes = None;
      skills = [
        { skill_id="Knowledge_Literacy"; name_cn="讀書識字"; category=Knowledge_Academic; level=7; proficiency=Some 7.0; mastery="駕輕就熟"; is_potential=false; description="讀寫能力。" };
        { skill_id="Knowledge_Accounting_Basic"; name_cn="基礎算術/記賬"; category=Knowledge_Academic; level=5; proficiency=Some 5.0; mastery="登堂入室"; is_potential=false; description="處理賬目。" };
      ];
      abilities = None; inventory = None; currency = None; equipment = None; (* Basic scholar clothes *)
      status_effects = [];
      current_location_id = "BWF_DocumentRoom_01"; (* Or "前往主廳途中" *)
      current_location_name = "黑風寨．文書房"; (* Or "前往主廳途中" *)
      current_action = "準備參加晨會 / 整理舊檔案";
      current_posture = Some "Standing";
      mood = "專注 (Focused) / 謹慎 (Cautious)";
      short_term_goal = Some "協助上官姑娘整理檔案。";
      long_term_goal = Some "在山寨安穩度日。";
      relationships = [
        { target_id="player_azhai"; target_name="阿宅"; affinity=(* Base *); enmity=(* Base *); trust=(* Base *); respect=(* ~Base+4? *); fear=(* Low *); notes="普通下屬。" };
        { target_id="npc_shangguan_yu_01"; target_name="上官玉"; affinity=5.0; enmity=0.0; trust=0.4; respect=0.6; notes="直接上司。" };
      ];
      ai_profile_id = Some "NPC_Scribe_Diligent";
      ai_state = Some [("CurrentTask", "AttendMorningMeeting / SortArchives")];
      plot_importance = Some 4; (* Support role *)
      known_player_knowledge = Some ["知道文書整理的重要性"];
      special_flags = Some ["文書人員"];
    };

    (* ... (If needed, add Liu Sao and Maidens - likely low stats, basic skills, location: Infirmary/Residence, task: Learning Nursing/Chores) ... *)

  ] (* End of npc_states list part 2 *)

  (* === 6. Location States === *)
  (* ... To be provided in the next part ... *)

  (* ... other sections ... *)

} (* Partial snapshot end *)

(* === 6. Location States === *)
  location_states = [
    (* --- 黑風寨整體 (Black Wind Fortress Overall) --- *)
    {
      location_id = "black_wind_fortress_overall";
      name_cn = "黑風寨 (整體區域)";
      location_type = `Settlement;
      description = "位於隱蔽山谷中的一個小型山寨據點，由阿宅領導。近期經歷了內部整頓、技術革新（精炭/煉鋼）和資源危機。目前正全力恢復生產。";
      parent_location_id = None;
      connected_locations = ["BWF_GateArea_01"; "BWF_MainArea_01"; "BWF_Residential_01"; "BWF_RearMountain_01"; "BWF_EastMineTunnel_Entrance_01"; "SECRET_EXIT_MistValley"];
      contained_npc_ids = (* List all current residents/members, ~174 people *);
      contained_item_ids = []; (* World items not in inventories *)
      location_flags = ["Fortified"; "HiddenLocation"; "ResourceScarce(Iron)"; "ProductionRestarting"; "HighAlert"; "PCControlled"; "NewIncentivesActive"];
      security_level = `High;
      morale_level = `VeryHigh; (* 士氣高漲 due to recent successes *)
      stress_level = `Moderate; (* 焦慮 due to long-term ore uncertainty *)
      resource_nodes = []; (* Specific nodes listed under sub-locations *)
      special_notes = Some "雖然近期取得技術突破，但鐵礦石的長期穩定供應是最大隱患。山寨的擴張和防禦能力受此嚴重制約。";
    };

    (* --- 主廳 (Main Hall) --- *)
    {
      location_id = "BWF_LeaderCourtyard_MainHall_01";
      name_cn = "黑風寨．頭領院落．主廳";
      location_type = `Building_Interior;
      description = "頭領處理事務、召開會議的主要場所。佈置簡潔但整齊。";
      parent_location_id = Some "BWF_LeaderCourtyard_01";
      connected_locations = ["BWF_LeaderCourtyard_01"];
      contained_npc_ids = (* Empty now, meeting participants leaving/dispersing *);
      contained_item_ids = []; (* Basic furniture *)
      location_flags = ["MeetingPlace"; "AdminCenter"];
      security_level = `High; morale_level = `Neutral; stress_level = `Low;
      resource_nodes = [];
      special_notes = Some "每日晨會召開地點。";
    };

    (* --- PC 臥房 (PC Bedroom) --- *)
    {
      location_id = "BWF_LeaderCourtyard_Bedroom_01";
      name_cn = "黑風寨．頭領院落．臥房";
      location_type = `Building_Interior;
      description = "阿宅的私人休息場所。相對安靜私密。";
      parent_location_id = Some "BWF_LeaderCourtyard_01";
      connected_locations = ["BWF_LeaderCourtyard_01"];
      contained_npc_ids = ["player_azhai"]; (* PC just woke up here *)
      contained_item_ids = []; (* PC items are in inventory *)
      location_flags = ["RestingPlace"; "Secure"];
      security_level = `VeryHigh; morale_level = `Neutral; stress_level = `Low;
      resource_nodes = [];
      special_notes = Some "PC的主要休息和私人活動地點。";
    };

    (* --- 鐵匠鋪 (Forge) --- *)
    {
      location_id = "BWF_Forge_01";
      name_cn = "黑風寨．鐵匠鋪";
      location_type = `Workshop;
      description = "山寨唯一的鐵匠鋪，由老鐵匠負責。近期因獲得精炭和新礦石而重新全力運轉，正在趕工打造鋼鎬。";
      parent_location_id = Some "BWF_RearMountain_01";
      connected_locations = ["BWF_RearMountain_01"; "BWF_Warehouse_01"];
      contained_npc_ids = ["Old_Blacksmith_01"; "KongKongEr_01"; (* Apprentices *)];
      contained_item_ids = ["item_tool_pickaxe_steel_proto_01"; (* Stored Prototypes *)]; (* Plus tools, equipment *)
      location_flags = ["Production_Forge"; "Steelmaking_Active"; "HighPriority"; "ResourceConsuming(Ore/Charcoal)"];
      security_level = `Moderate; morale_level = `Fanatical; stress_level = `High; (* High workload *)
      resource_nodes = [ (* Represents available resources AT the location *)
         { resource_id = "IronOre_HighQuality"; quantity = (* Amount delivered & not yet used, e.g., 40-50 Kgs? *); trend = `Decreasing };
         { resource_id = "RefinedCharcoal_Good"; quantity = (* Amount delivered & not yet used, e.g., 20-25 Kgs? *); trend = `Decreasing };
      ];
      special_notes = Some "目前正在全力生產鋼鎬，是山寨生產鏈的核心。";
    };

    (* --- 礦洞 (Mine Tunnel) --- *)
    {
      location_id = "BWF_Mine_EastTunnel_01";
      name_cn = "黑風寨．東區礦洞";
      location_type = `Underground_Mine;
      description = "山寨主要的（也是唯一的）鐵礦石來源，礦脈品質不高且開採困難。近期因PC介入和鋼鎬應用，產量大幅提升。";
      parent_location_id = Some "BWF_EastMineTunnel_Entrance_01";
      connected_locations = ["BWF_EastMineTunnel_Entrance_01"; "SECRET_EXIT_MistValley"]; (* Secret exit needs confirmation if PC revealed it *)
      contained_npc_ids = ["HuangJinbao"; "MaKui_MineGuardLeader"; (* Miners, Prisoners, Guards *)];
      contained_item_ids = [];
      location_flags = ["Production_Mine"; "LowYieldVein"; "PrisonerLabor"; "IncentiveSystemActive"; "HighPriority"];
      security_level = `High; morale_level = `High; (* Due to incentives/hope *) stress_level = `VeryHigh; (* Pressure to produce *)
      resource_nodes = [
        { resource_id = "IronOre_LowQualityVein"; quantity = (* Represents the potential remaining ore *); trend = `Stable?` }; (* Underlying vein quality *)
        { resource_id = "Coal_SmallVein"; quantity = (* Represents coal potential *); trend = `Stable?` };
      ];
      special_notes = Some "產量雖暫時提升，但長期供應仍依賴工具和人力。新的激勵制度正在實施。";
    };

    (* --- 炭窯區 (Kiln Area) --- *)
    {
      location_id = "BWF_Kiln_Area_01";
      name_cn = "黑風寨．後山炭窯區";
      location_type = `Workshop;
      description = "新建的改良炭窯所在地，由周平負責。第一爐精炭已成功產出，第二爐正在準備中。";
      parent_location_id = Some "BWF_RearMountain_01";
      connected_locations = ["BWF_RearMountain_01"; "BWF_LoggingCamp_01"; "BWF_Warehouse_01"];
      contained_npc_ids = ["ZhouPing_KilnMaster"; (* Kiln workers *)];
      contained_item_ids = []; (* Kiln structures *)
      location_flags = ["Production_Charcoal"; "ImprovedKiln"; "ResourceConsuming(Wood)"];
      security_level = `Moderate; morale_level = `High; stress_level = `Moderate; (* Wood supply pressure *)
      resource_nodes = [];
      special_notes = Some "第二爐精炭準備中，新窯建設緩慢。";
    };

    (* --- 傷兵營 (Infirmary) --- *)
    {
      location_id = "BWF_Infirmary_01";
      name_cn = "黑風寨．臨時傷兵安置點";
      location_type = `Building_Interior;
      description = "由秦嵐負責的臨時醫療點，用於安置和治療傷病員。";
      parent_location_id = Some "BWF_MainArea_01"; (* Or specific area *)
      connected_locations = ["BWF_MainArea_01"];
      contained_npc_ids = ["qin_lan"; "WangDachui_SmithApprentice"; "Que_Assassin"; "LiuSao_Helper"; (* Maidens/Trainees *)];
      contained_item_ids = []; (* Medical supplies stored separately? *)
      location_flags = ["Medical"; "Healing"; "TrainingArea(Nursing)"];
      security_level = `Moderate; morale_level = `Stable; stress_level = `Moderate; (* Due to patient conditions *)
      resource_nodes = [];
      special_notes = Some "王大槌恢復良好，'雀' 狀態不明。秦嵐應用了PC傳授的部分護理知識。";
    };

    (* ... Add other key locations like Warehouse, Logging Camp, Document Room, Barracks, Gate Area with updated flags/NPCs/notes ... *)
  ];

  (* === 7. Faction States === *)
  faction_states = [
    (* --- 黑風寨 (Black Wind Fortress) --- *)
    {
      faction_id = "black_wind_fortress";
      name_cn = "黑風寨";
      faction_type = `Player_Controlled_Settlement;
      leader_id = Some "player_azhai";
      key_members = ["player_azhai"; "qin_lan"; "ScarfaceLiu_Henchman"; "npc_shangguan_yu_01"; "Old_Blacksmith_01"; "HuangJinbao"; "ZhouPing_KilnMaster"; (* etc *)];
      population = Some 174; (* Based on R1084 snapshot *)
      goals = ["生存與發展"; "建立穩定的生產體系"; "提升武力與防禦"; "獲取外部情報"; "查明內部威脅"];
      policies = ["高警戒等級"; "嚴格管理制度"; "技術革新優先"; "礦石開採激勵政策"];
      reputation_summary = "內部威望極高，外界默默無聞";
      relationships = [
        { target_faction_id = "shadow_nest"; relationship_level = `Hostile; trend = `Stable };
        { target_faction_id = "unnamed_town_yamen"; relationship_level = `Hostile; trend = `Stable };
        { target_faction_id = "zhuo_family"; relationship_level = `Conditional_Contact; trend = `Uncertain };
      ];
      resources_summary = "糧食藥品尚足，薪柴緊張，【鐵器相關極度匱乏但正在恢復】，精炭供應啟動。";
      morale_summary = "非常高漲（因近期突破），但潛藏對礦石供應的焦慮。";
      overall_status = "危機初步緩解，生產開始恢復並技術升級，但資源瓶頸（長期礦石）和外部威脅依然嚴峻。";
      faction_flags = ["PlayerLed"; "Rebuilding"; "TechAdvancing"; "ResourceCrisis(Iron_LongTerm)"; "HighMorale"];
    };

    (* --- 影巢 (Shadow Nest) --- *)
    {
      faction_id = "shadow_nest";
      name_cn = "影巢";
      faction_type = `Criminal_Organization_Assassin;
      leader_id = None; (* Unknown *)
      key_members = ["Que_Assassin" (* Captured *)];
      population = None; (* Unknown *)
      goals = ["執行暗殺任務"; "獲取情報"; "擴大影響力"];
      policies = ["隱秘行動"; "手段殘酷"];
      reputation_summary = "江湖上臭名昭著的暗殺組織";
      relationships = [ { target_faction_id = "black_wind_fortress"; relationship_level = `Hostile; trend = `Stable } ];
      resources_summary = "未知，但應有情報網絡和特殊資源（毒藥等）。";
      morale_summary = "未知";
      overall_status = "刺殺黑風寨高層失敗，一名刺客被俘虜並重創，可能正在策劃反擊或調查。";
      faction_flags = ["Secretive"; "HighlyDangerous"; "AssassinNetwork"; "FailedMission(BWF)"];
    };

    (* --- 無名小鎮衙門 (Unnamed Town Yamen) --- *)
    {
      faction_id = "unnamed_town_yamen";
      name_cn = "無名小鎮衙門";
      faction_type = `Government_Local_Corrupt?;
      leader_id = Some "Qian_Bantou";
      key_members = ["Qian_Bantou"];
      population = None; (* Represents the Yamen staff *)
      goals = ["維持秩序（表面）"; "榨取利益"; "監視黑風寨"];
      policies = ["欺壓良善"; "收取賄賂"];
      reputation_summary = "在本地風評不佳";
      relationships = [ { target_faction_id = "black_wind_fortress"; relationship_level = `Hostile; trend = `Stable } ];
      resources_summary = "掌握本地部分稅收和權力。";
      morale_summary = "未知";
      overall_status = "持續監視黑風寨動向，可能在尋找發難的藉口。";
      faction_flags = ["LocalGovernment"; "Corrupt?"; "HostileToBWF"; "LedByQianBantou"];
    };

    (* --- 卓家 (Zhuo Family) --- *)
    {
      faction_id = "zhuo_family";
      name_cn = "卓家";
      faction_type = `Local_Gentry_Merchant?;
      leader_id = None; (* Unknown patriarch? *)
      key_members = ["zhuo_yingxue" (* Estranged? *)];
      population = None; (* Represents the family/clan *)
      goals = ["維持家族地位"; "經商獲利"];
      policies = ["未知"];
      reputation_summary = "本地有影響力的家族";
      relationships = [ { target_faction_id = "black_wind_fortress"; relationship_level = `Conditional_Contact; trend = `Uncertain } ];
      resources_summary = "可能擁有商業網絡和一定財富。";
      morale_summary = "未知";
      overall_status = "家族成員卓映雪因個人原因與黑風寨建立聯繫，家族本身態度不明。";
      faction_flags = ["LocalGentry"; "Merchant?"; "InternalConflict?"; "ContactViaZhuoYingxue"];
    };
  ];

  (* === 8. Resource States === *)
  resource_states = [
    (* Key resources updated to end of R1113 *)
    { resource_id = "IronOre_HighQuality"; name_cn = "優質鐵礦石"; category = `Raw_Material; quantity = (* ~50-60 Kgs? At Forge, decreasing *); max_quantity = None; trend = `Decreasing; production_rate = 0.0; consumption_rate = (* Forge rate *); quality = Some `High; notes = "PC親自挖掘，品質較好，正用於煉鋼。" };
    { resource_id = "IronOre_LowQuality"; name_cn = "低質鐵礦石"; category = `Raw_Material; quantity = (* ~10-20 Kgs? Remaining from earlier mining *); max_quantity = None; trend = `Stable; production_rate = (* Mine daily rate ~30-40 Kgs? *); consumption_rate = 0.0; quality = Some `Low; notes = "礦洞主要產出，品質差，利用率低。" };
    { resource_id = "RefinedCharcoal_Good"; name_cn = "精炭(精良)"; category = `Fuel; quantity = (* ~20-25 Kgs? In storage, after forge consumption *); max_quantity = Some 200.0?; trend = `Stable; production_rate = (* Batch 2 pending *); consumption_rate = (* Forge rate *); quality = Some `Good; notes = "首批產出，燃料效率高。第二爐準備中。" };
    { resource_id = "Tool_Pickaxe_Steel_Good"; name_cn = "鋼鎬(精良)"; category = `Tool; quantity = 5; max_quantity = None; trend = `Increasing; production_rate = (* Forge rate ~5-8/day? *); consumption_rate = 0.0; quality = Some `Good; notes = "新煉鋼技術產物，正在生產中。" };
     { resource_id = "Tool_Pickaxe_Steel_Proto"; name_cn = "鋼鎬原型"; category = `Tool; quantity = 2; max_quantity = None; trend = `Stable; production_rate = 0.0; consumption_rate = 0.0; quality = Some `Rare; notes = "首批試驗品，一把在黃金寶處，一把在悔過隊礦工處。" };
   { resource_id = "Tool_Pickaxe_Iron"; name_cn = "鐵鎬"; category = `Tool; quantity = (* ~4? From last batch + maybe a few old ones *); max_quantity = None; trend = `Decreasing; production_rate = 0.0; consumption_rate = (* High breakage rate *); quality = Some `Common; notes = "數量稀少，損耗嚴重。" };
    { resource_id = "Tool_Axe_Iron"; name_cn = "鐵斧"; category = `Tool; quantity = (* Very Low - Estimated 10-15? *); max_quantity = None; trend = `Decreasing; production_rate = 0.0; consumption_rate = (* Logging rate *); quality = Some `Common; notes = "嚴重短缺，影響伐木效率。" };
    { resource_id = "Wood_Dry"; name_cn = "可用干柴"; category = `Fuel; quantity = (* Estimated Low/Medium? *); max_quantity = Some 500.0?; trend = `Decreasing; production_rate = (* Drying rate *); consumption_rate = (* Charcoal Kiln rate + Daily use *); quality = Some `Common; notes = "供應緊張，僅夠炭窯勉強使用。" };
    { resource_id = "Wood_Raw"; name_cn = "未乾木材"; category = `Raw_Material; quantity = (* Estimated High? *); max_quantity = Some 1000.0?; trend = `Stable; production_rate = (* Logging rate *); consumption_rate = (* Drying rate *); quality = Some `Common; notes = "儲量尚可，伐木效率受工具制約。" };
    { resource_id = "Food_Grain"; name_cn = "糧食(穀物)"; category = `Food; quantity = (* Estimated Medium-High? *); max_quantity = Some 1500.0?; trend = `Decreasing; production_rate = 0.0; consumption_rate = (* Population rate *); quality = Some `Common; notes = "尚能支撐一段時間。" };
    { resource_id = "Food_Meat"; name_cn = "鮮肉"; category = `Food; quantity = (* Estimated Low? *); max_quantity = Some 100.0?; trend = `Stable; production_rate = (* Hunting rate *); consumption_rate = (* Population rate *); quality = Some `Common; notes = "供應不穩，來源主要靠馬六。" };
    { resource_id = "Medicine_Herbal"; name_cn = "基礎藥品"; category = `Medical; quantity = (* Estimated High? *); max_quantity = Some 300.0?; trend = `Stable; production_rate = 0.0; consumption_rate = (* Low *); quality = Some `Common; notes = "庫存充足（得益於交易）。" };
    { resource_id = "Resource_Salt"; name_cn = "食鹽"; category = `Consumable; quantity = (* Estimated High? *); max_quantity = Some 200.0?; trend = `Stable; production_rate = 0.0; consumption_rate = (* Low *); quality = Some `Common; notes = "庫存充足（得益於交易）。" };
    { resource_id = "Resource_Cloth"; name_cn = "布匹"; category = `Material; quantity = (* Estimated Very Low? *); max_quantity = Some 100.0?; trend = `Decreasing; production_rate = 0.0; consumption_rate = (* Low *); quality = Some `Common; notes = "匱乏，影響衣物、繃帶等製作。" };
    (* ... Other resources like Soap ingredients, etc. *)
   ];

  (* === 9. Active Quests/Tasks === *)
  (* ... To be provided in the next part ... *)

  (* === 10. World Map & Relationships (Brief overview) === *)
  (* ... To be provided in the next part ... *)

} (* Partial snapshot end *)

(* === 9. Active Quests/Tasks === *)
  active_quests = [
    (* --- Fortress Development & Production --- *)
    { quest_id = "TSK_SECURE_FORTRESS"; name = "鞏固山寨防禦"; status = `Active; current_stage = 2; objectives = ["維持高警戒等級"; "訓練衛隊"; "排查內應"; "獲取武器裝備"]; reward = None; failure_conditions = ["山寨被攻破"]; related_npcs = ["ScarfaceLiu_Henchman"]; notes = "持續進行中，警戒等級高，但裝備匱乏。" };
    { quest_id = "TSK_INCREASE_ORE_OUTPUT"; name = "提升鐵礦石產量"; status = `Active; current_stage = 3; objectives = ["滿足鍛造需求"; "建立穩定高效的開採流程"]; reward = Some "生產線恢復"; failure_conditions = ["鍛造長期停工"]; related_npcs = ["HuangJinbao"; "Old_Blacksmith_01"; "player_azhai"]; notes = "**核心任務!** PC親自下礦+鋼鎬+激勵政策使產量暫時激增，但長期穩定供應仍是大問題。" };
    { quest_id = "TSK_PRODUCE_IRON_TOOLS"; name = "生產基礎工具"; status = `Active; current_stage = 2; objectives = ["為各部門提供足夠工具(鎬/斧/鍬等)"]; reward = Some "生產效率提升"; failure_conditions = ["各項工作停滯"]; related_npcs = ["Old_Blacksmith_01"; "player_azhai"]; notes = "已轉向生產【鋼鎬】，目標尚需22把，正在全力生產中。" };
    { quest_id = "TSK_PRIORITIZE_PICKAXES"; name = "優先打造鐵鎬"; status = `Active; current_stage = 2; objectives = ["為礦隊提供足夠的鎬頭"]; reward = Some "礦石產量提升"; failure_conditions = ["礦隊無法作業"]; related_npcs = ["Old_Blacksmith_01"; "HuangJinbao"]; notes = "正在全力打造【鋼鎬】(目標22把)。" };
    { quest_id = "TSK_PRODUCE_STEEL"; name = "研發並生產鋼材"; status = `Active; current_stage = 2; objectives = ["掌握煉鋼技術"; "批量生產鋼製工具/武器"]; reward = Some "裝備質量提升"; failure_conditions = ["技術失敗/無礦石"]; related_npcs = ["Old_Blacksmith_01"; "player_azhai"]; notes = "**技術突破!** 概念已驗證，鋼鎬開始生產。需要持續優化和礦石供應。" };
    { quest_id = "TSK_SETUP_CHARCOAL_PRODUCTION"; name = "建立精炭生產線"; status = `Active; current_stage = 3; objectives = ["穩定產出精炭"; "建造更多改良炭窯"]; reward = Some "燃料供應穩定"; failure_conditions = ["鍛造缺乏燃料"]; related_npcs = ["ZhouPing_KilnMaster"; "ShiGan_LoggingLeader"]; notes = "首批精炭成功，第二爐準備中，受木材供應和建窯工具制約。" };
    { quest_id = "TSK_IMPROVE_LOGGING"; name = "提高伐木效率"; status = `Active; current_stage = 2; objectives = ["滿足炭窯及日常需求"; "獲取更好斧頭"]; reward = Some "木材供應穩定"; failure_conditions = ["炭窯斷供"]; related_npcs = ["ShiGan_LoggingLeader"; "Old_Blacksmith_01"]; notes = "效率有提升但壓力巨大，斧頭短缺是關鍵瓶頸。" };
    { quest_id = "TSK_ESTABLISH_TRANSPORT"; name = "建立運輸隊"; status = `Active; current_stage = 2; objectives = ["高效調度山寨內物資"]; reward = Some "物流效率提升"; failure_conditions = ["物資轉運不暢"]; related_npcs = ["LiuEr_TransportLeader"; "LiuSanhou_Logistics"]; notes = "運輸隊已建立並運作，效率受各環節產出影響。" };
    { quest_id = "TSK_DEVELOP_CRAFTS"; name = "發展手工藝"; status = `Active; current_stage = 1; objectives = ["製作獨輪車、改良工具等"; "培養工匠"]; reward = Some "生活便利性/生產輔助提升"; failure_conditions = []; related_npcs = ["KongKongEr_01"]; notes = "木工進行中，受金屬材料限制。" };
    { quest_id = "TSK_PROVIDE_FOOD"; name = "保障食物供應"; status = `Active; current_stage = 1; objectives = ["提供足夠的肉食和穀物"; "發展可持續食物來源"]; reward = Some "山寨穩定"; failure_conditions = ["出現饑荒"]; related_npcs = ["MaLiu_Hunter"; "ZhuTuhu_Butcher"]; notes = "穀物尚足，肉食不穩，狩獵進行中。" };
    { quest_id = "TSK_SETUP_ANIMAL_HUSBANDRY"; name = "建立動物飼養體系"; status = `Active; current_stage = 0; objectives = ["規劃飼養區域"; "獲取籠舍/飼料"; "照料活捉動物"]; reward = Some "穩定肉食/副產品來源"; failure_conditions = ["動物死亡/逃脫"]; related_npcs = ["MaLiu_Hunter"]; notes = "**新任務!** 已指派馬六負責，但缺乏具體規劃和資源。" };
    { quest_id = "TSK_PRODUCE_SOAP"; name = "製作肥皂"; status = `Active; current_stage = 0; objectives = ["掌握肥皂製作方法"; "批量生產"]; reward = Some "提升衛生水平"; failure_conditions = []; related_npcs = ["LiuSanhou_Logistics"; "player_azhai"]; notes = "多次嘗試失敗，等待PC指導。" };
    { quest_id = "TSK_COMPLETE_BURIALS"; name = "完成犧牲人員安葬"; status = `Active; current_stage = 0; objectives = ["挖掘墓地"; "安葬陳七等人"]; reward = Some "提升士氣/穩定人心"; failure_conditions = []; related_npcs = ["LiuSanhou_Logistics"]; notes = "因缺乏挖掘工具而進展緩慢。" };

    (* --- Intelligence & Personnel --- *)
    { quest_id = "TSK_INVESTIGATE_MOLE"; name = "調查內部奸細"; status = `Active; current_stage = 1; objectives = ["找出潛伏在山寨的內應"]; reward = Some "消除內部威脅"; failure_conditions = ["內應造成重大破壞"]; related_npcs = ["ScarfaceLiu_Henchman"; "player_azhai"]; notes = "持續進行中，尚無線索。" };
    { quest_id = "TSK_HANDLE_QUE"; name = "處理刺客'雀'"; status = `Active; current_stage = 2; objectives = ["弄清其狀況"; "獲取影巢情報"; "決定其最終處置"]; reward = Some "情報/消除威脅/潛在助力?"; failure_conditions = ["情報失誤/目標死亡/失控"]; related_npcs = ["Que_Assassin"; "qin_lan"; "player_azhai"]; notes = "目標深度昏迷，腦部異變中，PC進行過危險治療/針灸，效果不明，明日待觀察。" };
    { quest_id = "TSK_CARE_FOR_WANGDACHUI"; name = "照料王大槌"; status = `Active; current_stage = 2; objectives = ["使其完全康復"; "獲取關鍵情報(影爪?)"]; reward = Some "情報/恢復勞動力"; failure_conditions = ["目標死亡/情報錯失"]; related_npcs = ["WangDachui_SmithApprentice"; "qin_lan"]; notes = "恢復狀況極佳，接近恢復語言能力。" };
    { quest_id = "TSK_SORT_DOCUMENTS"; name = "整理山寨檔案"; status = `Active; current_stage = 2; objectives = ["分類統計所有舊檔案"; "尋找有用信息"]; reward = Some "情報/歷史記錄"; failure_conditions = []; related_npcs = ["npc_shangguan_yu_01"; "SunJi_Accountant"; "WuYong_Scribe"]; notes = "進展緩慢，檔案數量龐大。" };
    { quest_id = "TSK_TRAIN_GUARDS"; name = "訓練衛隊"; status = `Active; current_stage = 1; objectives = ["教授黑風基礎拳"; "提升衛隊戰鬥力"]; reward = Some "提升山寨防禦力"; failure_conditions = ["衛隊戰力低下"]; related_npcs = ["ScarfaceLiu_Henchman"]; notes = "第一批訓練進行中。" };

    (* --- External Relations --- *)
    { quest_id = "TSK_AWAIT_ZHUO_RETURN"; name = "等待卓映雪交易"; status = `Active; current_stage = 1; objectives = ["獲取卓映雪帶來的生鐵和布匹"]; reward = Some "資源補充"; failure_conditions = ["卓映雪失約/無法完成"]; related_npcs = ["zhuo_yingxue"; "WangDachui_SmithApprentice"]; notes = "卓映雪歸期未知，短期內難以指望。" };
    { quest_id = "TSK_EXPLORE_MISTY_VALLEY"; name = "探索迷霧谷"; status = `Inactive; current_stage = 0; objectives = ["查明谷內情況"; "尋找資源或盟友(獵戶寨?)"]; reward = Some "新地圖/資源/關係"; failure_conditions = ["探索隊失敗"]; related_npcs = ["ShiGan_LoggingLeader"; "MaLiu_Hunter"]; notes = "有潛在價值，但目前非優先事項。" };
    { quest_id = "TSK_EXTERNAL_TRADE_IRON"; name = "尋找外部鐵料來源"; status = `Active; current_stage = 0; objectives = ["建立秘密渠道購買生鐵/礦石"]; reward = Some "解決鐵料危機"; failure_conditions = ["渠道暴露/無法購得"]; related_npcs = ["ScarfaceLiu_Henchman"; "npc_shangguan_yu_01"]; notes = "**新核心任務**。PC正在考慮中，可嘗試聯繫癩痢三或其他途徑。" };

    (* --- Terminated/Completed --- *)
    { quest_id = "TSK_FIND_WANGQI"; name = "尋找王七下落"; status = `Terminated; current_stage = -1; objectives = []; reward = None; failure_conditions = []; related_npcs = []; notes = "已於 R1091 由 PC 決定終止。" };
    { quest_id = "TSK_PRODUCE_CHARCOAL_BATCH1"; name = "燒製第一爐精炭"; status = `Completed; current_stage = -1; objectives = []; reward = Some "獲得精炭，解決燃料問題"; failure_conditions = []; related_npcs = ["ZhouPing_KilnMaster"]; notes = "已於 R1092 成功驗收。" };
  ];

  (* === 10. World Map & Relationships Overview === *)
  world_map_info = {
    known_locations = [
      { loc_id="black_wind_fortress_overall"; name="黑風寨"; type_=`Settlement; status="生產恢復中/士氣高漲/缺鐵" };
      { loc_id="unnamed_town"; name="無名小鎮"; type_=`Town; status="敵對官府/潛在交易點?" };
      { loc_id="misty_valley"; name="迷霧谷"; type_=`Wilderness_Valley; status="未知/可通過隧道到達/可能有獵戶寨" };
      { loc_id="zhuo_residence"; name="卓府"; type_=`Building_Estate; status="位置已知?/卓映雪出身地" };
      (* Other locations might exist but are unknown *)
    ];
    known_routes = [
      { route_id="route_bwf_town"; start_loc="black_wind_fortress_overall"; end_loc="unnamed_town"; travel_time="約半日?"; difficulty="高(需潛行/避開官府)"; notes="主要下山路徑。" };
      { route_id="route_bwf_mistvalley"; start_loc="black_wind_fortress_overall"; end_loc="misty_valley"; travel_time="未知"; difficulty="中(隧道)"; notes="通過東區礦洞秘密隧道。" };
    ];
    faction_relationship_summary = [
      ("黑風寨", "影巢", "敵對/暗殺目標");
      ("黑風寨", "無名小鎮衙門", "敵對/被監視");
      ("黑風寨", "卓家", "有條件接觸/關係不明朗");
    ];
    key_character_relationship_summary = [
      ("阿宅", "秦嵐", "複雜信任/依賴/敬畏");
      ("阿宅", "疤臉劉", "絕對忠誠/可靠下屬");
      ("阿宅", "上官玉", "謹慎合作/觀察評估");
      ("阿宅", "老鐵匠", "崇拜/師徒情誼");
      ("阿宅", "黃金寶", "狂熱崇拜/驅使對象");
      ("阿宅", "周平", "高度信服/技術依賴");
      ("阿宅", "'雀'", "控制/潛在威脅/情報源/關係扭曲");
      ("王大槌", "卓映雪", "關係密切/牽掛");
    ];
    map_notes = "世界地圖認知範圍非常有限，主要集中在黑風寨及其周邊的無名小鎮和迷霧谷入口。外部世界廣闊而危險。";
  };

} (* === End of world_snapshot_r1113 === *)